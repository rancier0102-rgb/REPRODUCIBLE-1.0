<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movies+ HD</title>

<style>
/* ============================================
   VARIABLES Y RESET
   ============================================ */
:root {
  --primary: #e50914;
  --bg: #141414;
  --bg-secondary: #000000;
  --card: #181818;
  --card-hover: #2a2a2a;
  --text: #ffffff;
  --text-muted: #999999;
  --text-dim: #666666;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  padding-top: 40px;
}

/* Scrollbar personalizada */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--text-dim);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-muted);
}

/* ============================================
   LOADER
   ============================================ */
.loader-container {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  transition: opacity 0.5s ease;
}

.loader-container.fade-out {
  opacity: 0;
  pointer-events: none;
}

.loader-content {
  text-align: center;
}

.loader-spinner {
  width: 50px;
  height: 50px;
  border: 3px solid rgba(229, 9, 20, 0.2);
  border-top-color: var(--primary);
  border-radius: 50%;
  margin: 0 auto 1rem;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loader-text {
  color: var(--text-muted);
  font-size: 1rem;
  letter-spacing: 1px;
}

/* ============================================
   CONTENIDO PRINCIPAL
   ============================================ */
.main-content {
  position: relative;
  padding-bottom: 50px;
  min-height: 100vh;
}

/* ============================================
   SECCI√ìN DE CARRUSEL
   ============================================ */
.carousel-section {
  margin-bottom: 3rem;
  padding: 0 4%;
  position: relative;
  opacity: 0;
  animation: fadeIn 0.8s ease forwards;
}

.carousel-section:nth-child(1) { animation-delay: 0.1s; }
.carousel-section:nth-child(2) { animation-delay: 0.2s; }
.carousel-section:nth-child(3) { animation-delay: 0.3s; }
.carousel-section:nth-child(4) { animation-delay: 0.4s; }
.carousel-section:nth-child(5) { animation-delay: 0.5s; }

@keyframes fadeIn {
  to {
    opacity: 1;
  }
}

.carousel-header {
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
  position: relative;
}

.carousel-title {
  font-size: 1.4rem;
  font-weight: 600;
  color: var(--text);
  transition: color 0.3s ease;
}

.carousel-section:hover .carousel-title {
  color: var(--primary);
}

.movie-count {
  margin-left: 1rem;
  padding: 4px 12px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  font-size: 0.85rem;
  color: var(--text-muted);
}

/* ============================================
   CARRUSEL CONTAINER
   ============================================ */
.carousel-container {
  position: relative;
  overflow: visible;
  margin: 0 -4%;
  padding: 0 4%;
}

.carousel-wrapper {
  overflow-x: auto;
  overflow-y: visible;
  scroll-behavior: smooth;
  scrollbar-width: none;
  -ms-overflow-style: none;
  padding: 10px 0 30px;
}

.carousel-wrapper::-webkit-scrollbar {
  display: none;
}

.carousel-track {
  display: flex;
  gap: 0.5rem;
  padding: 0 4%;
}

/* ============================================
   TARJETAS DE PEL√çCULAS
   ============================================ */
.movie-card {
  flex: 0 0 auto;
  width: 200px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  border-radius: 4px;
  overflow: hidden;
  background: var(--card);
}

.movie-card:hover {
  transform: scale(1.3) translateY(-20px);
  z-index: 100;
  box-shadow: 0 10px 40px rgba(0,0,0,0.8);
}

.movie-card:hover .movie-info {
  opacity: 1;
  transform: translateY(0);
}

.movie-poster {
  position: relative;
  width: 100%;
  padding-bottom: 150%;
  background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
  overflow: hidden;
}

.movie-poster img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: opacity 0.3s ease;
}

.movie-poster.loading::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.1),
    transparent
  );
  animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.movie-info {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 1rem;
  background: linear-gradient(to top,
    rgba(0,0,0,0.9) 0%,
    rgba(0,0,0,0.7) 50%,
    transparent 100%);
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s ease;
}

.movie-title {
  font-size: 0.95rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  line-height: 1.3;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
}

.movie-meta {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.85rem;
  color: var(--text-muted);
}

.movie-year {
  color: #46d369;
  font-weight: 600;
}

.movie-quality {
  padding: 2px 6px;
  background: var(--primary);
  border-radius: 3px;
  font-size: 0.75rem;
  font-weight: bold;
  text-transform: uppercase;
}

.movie-play {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 60px;
  height: 60px;
  background: rgba(0,0,0,0.7);
  border: 2px solid white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: all 0.3s ease;
}

.movie-card:hover .movie-play {
  opacity: 1;
}

.movie-play::after {
  content: '‚ñ∂';
  color: white;
  font-size: 1.5rem;
  margin-left: 4px;
}

/* ============================================
   BOTONES DE NAVEGACI√ìN DEL CARRUSEL
   ============================================ */
.carousel-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 50px;
  height: 100px;
  background: rgba(0,0,0,0.5);
  border: none;
  color: white;
  font-size: 2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 50;
}

.carousel-container:hover .carousel-nav {
  opacity: 1;
}

.carousel-nav:hover {
  background: rgba(0,0,0,0.8);
}

.carousel-nav.prev {
  left: 0;
  border-radius: 0 4px 4px 0;
}

.carousel-nav.next {
  right: 0;
  border-radius: 4px 0 0 4px;
}

/* ============================================
   ESTADO VAC√çO
   ============================================ */
.empty-state {
  display: none;
  text-align: center;
  padding: 100px 20px;
  color: var(--text-muted);
}

.empty-state.show {
  display: block;
}

.empty-icon {
  font-size: 5rem;
  margin-bottom: 2rem;
  opacity: 0.5;
}

.empty-title {
  font-size: 2rem;
  margin-bottom: 1rem;
  color: var(--text);
}

.empty-message {
  font-size: 1.1rem;
  max-width: 500px;
  margin: 0 auto;
}

/* ============================================
   RESPONSIVE
   ============================================ */
@media (max-width: 1200px) {
  .movie-card {
    width: 180px;
  }
}

@media (max-width: 768px) {
  body {
    padding-top: 20px;
  }
  
  .movie-card {
    width: 140px;
  }
  
  .carousel-track {
    padding: 0 2%;
  }
  
  .carousel-nav {
    display: none;
  }
  
  .carousel-title {
    font-size: 1.2rem;
  }
}

@media (max-width: 480px) {
  .movie-card {
    width: 120px;
  }
  
  .movie-card:hover {
    transform: scale(1.1);
  }
  
  .carousel-title {
    font-size: 1.1rem;
  }
  
  .movie-count {
    font-size: 0.75rem;
    padding: 2px 8px;
  }
}

/* ============================================
   ANIMACIONES DE SCROLL
   ============================================ */
.fade-in {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.6s ease;
}

.fade-in.visible {
  opacity: 1;
  transform: translateY(0);
}
</style>
</head>
<body>

<!-- Loader -->
<div class="loader-container" id="loader">
  <div class="loader-content">
    <div class="loader-spinner"></div>
    <div class="loader-text">Cargando pel√≠culas...</div>
  </div>
</div>

<!-- Main Content -->
<main class="main-content" id="mainContent">
  <!-- Los carruseles se generar√°n aqu√≠ din√°micamente -->
</main>

<!-- Empty State -->
<div class="empty-state" id="emptyState">
  <div class="empty-icon">üé¨</div>
  <h2 class="empty-title">No hay pel√≠culas disponibles</h2>
  <p class="empty-message">
    Por favor, verifica que los archivos de datos est√©n configurados correctamente.
  </p>
</div>

<script>
'use strict';

// ============================================
// CONFIGURACI√ìN
// ============================================
const CONFIG = {
  // IMPORTANTE: Actualiza estos valores con tu informaci√≥n
  GITHUB_USER: 'rancier0102-rgb',         // <-- CAMBIA POR TU USUARIO
  GITHUB_REPO: 'REPRODUCIBLE-1.0',     // <-- CAMBIA POR TU REPOSITORIO
  GITHUB_BRANCH: 'main',              // <-- 'main' o 'master'
  
  get BASE_URL() {
    return `https://raw.githubusercontent.com/${this.GITHUB_USER}/${this.GITHUB_REPO}/${this.GITHUB_BRANCH}`;
  },
  
  get MANIFEST_URL() {
    return `${this.BASE_URL}/manifest.json`;
  },
  
  // Configuraci√≥n UI
  MOVIES_PER_ROW: 8,
  SCROLL_AMOUNT: 3,
  USE_CACHE: true,
  CACHE_DURATION: 3600000 // 1 hora
};

// ============================================
// APLICACI√ìN PRINCIPAL
// ============================================
class MoviesCarouselApp {
  constructor() {
    this.movies = [];
    this.moviesByYear = {};
    this.currentScrollPositions = {};
    
    this.init();
  }
  
  async init() {
    console.log('üé¨ Iniciando Movies+ Carousel');
    
    try {
      // Cargar datos
      await this.loadManifest();
      await this.loadChunks();
      
      // Organizar por a√±o
      this.organizeByYear();
      
      // Renderizar carruseles
      this.renderCarousels();
      
      // Configurar eventos
      this.setupCarouselNavigation();
      this.setupScrollEffects();
      
      // Ocultar loader
      this.hideLoader();
      
      console.log(`‚úÖ ${this.movies.length} pel√≠culas cargadas`);
      
    } catch (error) {
      console.error('‚ùå Error:', error);
      this.showEmptyState();
      this.hideLoader();
    }
  }
  
  async loadManifest() {
    // Intentar cach√©
    if (CONFIG.USE_CACHE) {
      const cached = this.getFromCache('manifest');
      if (cached) {
        console.log('üì¶ Manifest desde cach√©');
        this.manifest = cached;
        return;
      }
    }
    
    // Cargar desde GitHub
    console.log('üì• Cargando manifest desde:', CONFIG.MANIFEST_URL);
    const response = await fetch(CONFIG.MANIFEST_URL);
    
    if (!response.ok) {
      throw new Error('No se pudo cargar el manifest');
    }
    
    this.manifest = await response.json();
    
    // Guardar en cach√©
    if (CONFIG.USE_CACHE) {
      this.saveToCache('manifest', this.manifest);
    }
  }
  
  async loadChunks() {
    if (!this.manifest?.chunks) {
      throw new Error('No hay chunks disponibles');
    }
    
    console.log(`üì¶ Cargando ${this.manifest.chunks.length} chunks...`);
    
    for (const chunkInfo of this.manifest.chunks) {
      try {
        const chunkUrl = `${CONFIG.BASE_URL}/${chunkInfo.file}`;
        
        // Intentar cach√©
        if (CONFIG.USE_CACHE) {
          const cached = this.getFromCache(`chunk_${chunkInfo.id}`);
          if (cached) {
            console.log(`‚ö° Chunk ${chunkInfo.id} desde cach√©`);
            this.processChunk(cached);
            continue;
          }
        }
        
        // Cargar desde GitHub
        console.log(`üì• Cargando chunk: ${chunkInfo.id}`);
        const response = await fetch(chunkUrl);
        
        if (!response.ok) {
          console.error(`‚ùå Error cargando chunk ${chunkInfo.id}`);
          continue;
        }
        
        const chunkData = await response.json();
        
        // Guardar en cach√©
        if (CONFIG.USE_CACHE) {
          this.saveToCache(`chunk_${chunkInfo.id}`, chunkData);
        }
        
        this.processChunk(chunkData);
        
      } catch (error) {
        console.error(`Error cargando chunk ${chunkInfo.id}:`, error);
      }
    }
  }
  
  processChunk(chunkData) {
    const movies = chunkData.movies || [];
    
    movies.forEach(movie => {
      const processedMovie = {
        titulo: movie.t || movie.titulo || 'Sin t√≠tulo',
        enlace: movie.l || movie.enlace || '#',
        year: movie.y || movie.year || movie.ano || 2024,
        poster: movie.p || movie.poster || this.getDefaultPoster(),
        genero: movie.g || movie.genero || '',
        calidad: movie.q || movie.calidad || 'HD'
      };
      
      this.movies.push(processedMovie);
    });
  }
  
  organizeByYear() {
    this.moviesByYear = {};
    
    this.movies.forEach(movie => {
      const year = movie.year;
      if (!this.moviesByYear[year]) {
        this.moviesByYear[year] = [];
      }
      this.moviesByYear[year].push(movie);
    });
    
    // Ordenar pel√≠culas dentro de cada a√±o alfab√©ticamente
    Object.keys(this.moviesByYear).forEach(year => {
      this.moviesByYear[year].sort((a, b) => 
        a.titulo.localeCompare(b.titulo, 'es')
      );
    });
  }
  
  renderCarousels() {
    const mainContent = document.getElementById('mainContent');
    
    if (Object.keys(this.moviesByYear).length === 0) {
      this.showEmptyState();
      return;
    }
    
    // Limpiar contenido
    mainContent.innerHTML = '';
    
    // Ordenar a√±os de mayor a menor
    const sortedYears = Object.keys(this.moviesByYear)
      .sort((a, b) => b - a);
    
    // Crear carrusel para cada a√±o
    sortedYears.forEach((year, index) => {
      const movies = this.moviesByYear[year];
      const section = this.createCarouselSection(year, movies, index);
      mainContent.appendChild(section);
    });
  }
  
  createCarouselSection(year, movies, index) {
    const section = document.createElement('section');
    section.className = 'carousel-section fade-in';
    section.dataset.year = year;
    
    // T√≠tulo simple sin iconos
    const sectionTitle = `Pel√≠culas ${year}`;
    
    section.innerHTML = `
      <div class="carousel-header">
        <h2 class="carousel-title">${sectionTitle}</h2>
        <span class="movie-count">${movies.length}</span>
      </div>
      <div class="carousel-container">
        <button class="carousel-nav prev" data-year="${year}" data-direction="prev">‚Äπ</button>
        <button class="carousel-nav next" data-year="${year}" data-direction="next">‚Ä∫</button>
        <div class="carousel-wrapper" id="carousel-${year}">
          <div class="carousel-track">
            ${movies.map(movie => this.createMovieCard(movie)).join('')}
          </div>
        </div>
      </div>
    `;
    
    return section;
  }
  
  createMovieCard(movie) {
    return `
      <article class="movie-card" onclick="app.playMovie('${movie.enlace}')" title="${movie.titulo}">
        <div class="movie-poster">
          <img 
            src="${movie.poster}" 
            alt="${movie.titulo}"
            loading="lazy"
            onerror="this.src='${this.getDefaultPoster()}'">
          <div class="movie-play"></div>
        </div>
        <div class="movie-info">
          <h3 class="movie-title">${movie.titulo}</h3>
          <div class="movie-meta">
            <span class="movie-year">${movie.year}</span>
            ${movie.calidad ? `<span class="movie-quality">${movie.calidad}</span>` : ''}
          </div>
        </div>
      </article>
    `;
  }
  
  setupCarouselNavigation() {
    // Configurar botones de navegaci√≥n
    document.querySelectorAll('.carousel-nav').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const year = e.target.dataset.year;
        const direction = e.target.dataset.direction;
        this.scrollCarousel(year, direction);
      });
    });
    
    // Configurar scroll con mouse wheel para desplazamiento horizontal
    document.querySelectorAll('.carousel-wrapper').forEach(wrapper => {
      wrapper.addEventListener('wheel', (e) => {
        if (e.deltaY !== 0) {
          e.preventDefault();
          wrapper.scrollLeft += e.deltaY;
        }
      });
    });
  }
  
  scrollCarousel(year, direction) {
    const carousel = document.getElementById(`carousel-${year}`);
    if (!carousel) return;
    
    const scrollAmount = 200 * CONFIG.SCROLL_AMOUNT;
    
    if (direction === 'next') {
      carousel.scrollLeft += scrollAmount;
    } else {
      carousel.scrollLeft -= scrollAmount;
    }
  }
  
  setupScrollEffects() {
    // Fade in animation on scroll
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { 
      threshold: 0.1,
      rootMargin: '50px'
    });
    
    document.querySelectorAll('.fade-in').forEach(el => {
      observer.observe(el);
    });
  }
  
  playMovie(url) {
    console.log('‚ñ∂Ô∏è Reproduciendo:', url);
    if (url && url !== '#') {
      window.open(url, '_blank', 'noopener,noreferrer');
    } else {
      console.log('URL no v√°lida');
    }
  }
  
  hideLoader() {
    const loader = document.getElementById('loader');
    loader.classList.add('fade-out');
    setTimeout(() => {
      loader.style.display = 'none';
    }, 500);
  }
  
  showEmptyState() {
    document.getElementById('emptyState').classList.add('show');
    document.getElementById('mainContent').style.display = 'none';
  }
  
  getDefaultPoster() {
    return 'data:image/svg+xml,' + encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="300" height="450" viewBox="0 0 300 450">
        <rect width="300" height="450" fill="#181818"/>
        <text x="150" y="225" font-family="Arial" font-size="60" fill="#333" text-anchor="middle">üé¨</text>
      </svg>
    `);
  }
  
  // Sistema de cach√© simple
  getFromCache(key) {
    if (!CONFIG.USE_CACHE) return null;
    
    try {
      const item = localStorage.getItem(key);
      if (!item) return null;
      
      const data = JSON.parse(item);
      if (Date.now() > data.expiry) {
        localStorage.removeItem(key);
        return null;
      }
      
      return data.value;
    } catch (e) {
      return null;
    }
  }
  
  saveToCache(key, value) {
    if (!CONFIG.USE_CACHE) return;
    
    try {
      const data = {
        value: value,
        expiry: Date.now() + CONFIG.CACHE_DURATION
      };
      localStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
      console.warn('Cache error:', e);
    }
  }
}

// ============================================
// INICIALIZACI√ìN
// ============================================
window.addEventListener('DOMContentLoaded', () => {
  console.log('DOM Cargado, iniciando aplicaci√≥n...');
  window.app = new MoviesCarouselApp();
});

// Para debugging
console.log('Para debug usa: window.app');
</script>

</body>
</html>
