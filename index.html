<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
    <title>Stream Player ‚Ä¢ TV</title>
    
    <!-- Librer√≠as del Reproductor Universal -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@latest/dist/shaka-player.compiled.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flv.js@latest/dist/flv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mpegts.js@latest/dist/mpegts.js"></script>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wavesurfer.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/howler@latest/dist/howler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/webvtt-parser@2.2.0/dist/parser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mux.js@latest/dist/mux.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* CSS original del Index - NO MODIFICAR */
        :root { 
            --bg: #0B0B0B; 
            --text: #FFFFFF; 
            --accent: #E50914; 
            --focus: #FFFFFF; 
            --radius: 8px; 
            --gutter: clamp(20px, 4vw, 40px); 
        }
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        html, body { 
            height: 100%; 
            overflow: hidden; 
            background: var(--bg); 
            color: var(--text); 
            font-family: system-ui, -apple-system, sans-serif; 
        }
        .navbar { 
            display: flex; 
            align-items: center; 
            gap: 14px; 
            padding: 14px var(--gutter); 
            position: sticky; 
            top: 0; 
            z-index: 50; 
            background: rgba(11, 11, 11, 0.9); 
            backdrop-filter: blur(10px); 
        }
        .navbar a { 
            color: #cfcfcf; 
            text-decoration: none; 
            font-weight: 600; 
            padding: 8px 12px; 
            border-radius: 6px; 
            cursor: pointer; 
        }
        .navbar a.active { 
            color: #fff; 
            background: rgba(229, 9, 20, 0.2); 
        }
        
        .navbar a:focus, a.movie-card:focus, .play-btn:focus { 
            outline: 3px solid var(--focus); 
            outline-offset: 2px; 
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); 
            transform: scale(1.05); 
        }

        #heroBanner { 
            position: relative; 
            height: min(40vh, 400px); 
            display: flex; 
            align-items: center; 
            padding: 0 var(--gutter); 
            background-size: cover; 
            background-position: center; 
        }
        #heroBanner::before { 
            content: ''; 
            position: absolute; 
            inset: 0; 
            background: linear-gradient(90deg, rgba(11, 11, 11, 0.9) 0%, rgba(11, 11, 11, 0.4) 45%, transparent 70%); 
        }
        .hero-content { 
            position: relative; 
            z-index: 2; 
            max-width: min(600px, 60vw); 
        }
        .hero-title { 
            font-size: clamp(2rem, 4vw, 3rem); 
            line-height: 1.1; 
            margin-bottom: 8px; 
            font-weight: 800; 
        }
        .hero-description { 
            color: #d0d0d0; 
            font-size: clamp(0.9rem, 1.5vw, 1.1rem); 
            line-height: 1.4; 
            margin-bottom: 16px; 
        }
        .hero-buttons a { 
            padding: 12px 20px; 
            font-size: 16px; 
            font-weight: 700; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            text-decoration: none; 
        }
        .play-btn { 
            background: #fff; 
            color: #000; 
        }
        #main-content-wrapper { 
            height: calc(100% - min(40vh, 400px) - 62px); 
            overflow: hidden; 
            position: relative; 
        }
        .content-section { 
            height: 100%; 
            overflow-y: auto; 
            overflow-x: hidden; 
            position: absolute; 
            width: 100%; 
            top: 0; 
            left: 0; 
            opacity: 1; 
            transition: opacity 0.2s; 
        }
        .content-section.hidden { 
            opacity: 0; 
            pointer-events: none; 
        }
        .section-title { 
            font-size: 22px; 
            font-weight: 800; 
            margin: 12px var(--gutter) 8px; 
        }
        .container-carrusel { 
            display: flex; 
            gap: 12px; 
            overflow-x: auto; 
            padding: 0 var(--gutter) 20px; 
            scroll-behavior: smooth; 
        }
        .container-carrusel::-webkit-scrollbar { 
            display: none; 
        }
        
        a.movie-card { 
            display: block; 
            width: 180px; 
            flex: 0 0 180px; 
            border-radius: var(--radius); 
            overflow: hidden; 
            cursor: pointer; 
            transition: transform 0.2s ease; 
            background: #181818; 
            text-decoration: none; 
        }
        
        .movie-card img { 
            width: 100%; 
            height: 270px; 
            object-fit: cover; 
            display: block; 
            background: #222; 
        }
        .movie-card .title { 
            font-size: 14px; 
            font-weight: 600; 
            padding: 8px; 
            color: #f0f0f0; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }
        .progress-indicator { 
            position: absolute; 
            left: 0; 
            bottom: 0; 
            height: 4px; 
            background: linear-gradient(90deg, var(--accent), #ff6b6b); 
            width: 0%; 
        }
        .loading-state, .error-state { 
            padding: 40px var(--gutter); 
            text-align: center; 
            color: #ccc; 
        }
        .loading-spinner { 
            border: 4px solid #333; 
            border-top: 4px solid var(--accent); 
            border-radius: 50%; 
            width: 40px; 
            height: 40px; 
            animation: spin 1s linear infinite; 
            margin: 0 auto 16px; 
        }
        @keyframes spin { 
            from { transform: rotate(0); } 
            to { transform: rotate(360deg); } 
        }
        
        /* CSS del Reproductor - Integrado */
        .ultra-player {
            max-width: 100%;
            margin: 0;
            padding: 20px;
            background: var(--bg);
            height: 100%;
            overflow-y: auto;
        }

        .player-header {
            background: linear-gradient(135deg, var(--accent), #b8070f);
            padding: 20px;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 4px 20px rgba(229, 9, 20, 0.3);
            margin-bottom: 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo-text h1 {
            font-size: 24px;
            margin: 0;
            color: white;
        }

        .logo-text p {
            font-size: 12px;
            margin: 0;
            opacity: 0.9;
        }

        .player-layout {
            display: grid;
            grid-template-columns: 320px 1fr 280px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-top: none;
            min-height: 500px;
            height: calc(100vh - 250px);
        }

        @media (max-width: 1200px) {
            .player-layout {
                grid-template-columns: 1fr;
            }
            
            .sidebar-left, .sidebar-right {
                display: none;
            }
        }

        .sidebar-left, .sidebar-right {
            background: #1a1a1a;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar-left {
            border-right: 1px solid #333;
        }

        .sidebar-right {
            border-left: 1px solid #333;
        }

        .video-container {
            background: #000;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #mainVideo {
            width: 100%;
            height: 100%;
            max-height: 100%;
            background: #000;
        }

        .controls-container {
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.7));
            padding: 20px;
            border-top: 1px solid #333;
        }

        .progress-container {
            margin-bottom: 15px;
            position: relative;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress-buffer {
            position: absolute;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .progress-played {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ff6b6b);
            border-radius: 3px;
            width: 0%;
        }

        .controls-main {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .control-btn:hover {
            background: var(--accent);
            transform: scale(1.1);
        }

        .time-display {
            color: white;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            min-width: 120px;
            text-align: center;
        }

        .controls-secondary {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-slider {
            width: 100px;
            -webkit-appearance: none;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
        }

        .playlist {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .playlist-item {
            background: #2a2a2a;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .playlist-item:hover {
            background: #1a1a1a;
            border-color: var(--accent);
            transform: translateX(5px);
        }

        .playlist-item.active {
            background: linear-gradient(135deg, var(--accent), #b8070f);
            border-color: var(--accent);
        }

        .playlist-item.active .item-name,
        .playlist-item.active .item-details {
            color: white;
        }

        .item-thumbnail {
            width: 40px;
            height: 40px;
            background: #0a0a0a;
            border-radius: 4px;
            margin-right: 12px;
            float: left;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--accent);
        }

        .item-name {
            font-size: 13px;
            font-weight: 500;
            color: white;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .item-details {
            font-size: 11px;
            color: #aaaaaa;
            display: flex;
            gap: 10px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-title i {
            color: var(--accent);
        }

        .info-item {
            background: #2a2a2a;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #333;
            margin-bottom: 10px;
        }

        .info-label {
            font-size: 11px;
            color: #aaaaaa;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 14px;
            color: white;
            font-weight: 600;
        }

        .btn {
            padding: 12px 24px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #b8070f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.3);
        }

        .btn-secondary {
            background: #2a2a2a;
        }

        .btn-secondary:hover {
            background: #1a1a1a;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
            z-index: 100;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(229, 9, 20, 0.2);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            color: white;
            font-size: 14px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            display: none;
            animation: slideIn 0.3s ease;
            z-index: 1000;
            max-width: 350px;
        }

        .notification.active {
            display: block;
        }

        .notification.success {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .notification.error {
            border-color: #ff3366;
            background: rgba(255, 51, 102, 0.1);
        }

        .notification.warning {
            border-color: #ffaa00;
            background: rgba(255, 170, 0, 0.1);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
            color: white;
        }

        .notification-message {
            font-size: 12px;
            color: #aaaaaa;
        }

        /* Estilos para pantalla completa */
        .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: #000;
        }
        
        .fullscreen-mode .navbar,
        .fullscreen-mode #heroBanner,
        .fullscreen-mode .player-header,
        .fullscreen-mode .sidebar-left,
        .fullscreen-mode .sidebar-right,
        .fullscreen-mode .controls-container {
            display: none !important;
        }
        
        .fullscreen-mode .player-layout {
            grid-template-columns: 1fr;
            height: 100vh;
            border: none;
        }
        
        .fullscreen-mode .video-container {
            height: 100%;
        }
        
        .fullscreen-mode #mainVideo {
            width: 100%;
            height: 100%;
        }
        
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            opacity: 1;
            transition: opacity 0.5s;
        }
        
        .fullscreen-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .fullscreen-overlay .message {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .fullscreen-overlay .hint {
            font-size: 16px;
            color: #aaa;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="fullscreen-overlay" id="fullscreenOverlay">
        <div class="message">Modo Pantalla Completa Activado</div>
        <div class="hint">Presiona ESC para salir</div>
    </div>
    
    <div class="navbar" role="navigation">
        <a id="link-inicio" class="active" onclick="App.showSection('inicio')">Inicio</a>
        <a id="link-historial" onclick="App.showSection('historial')">Seguir viendo</a>
        <a id="link-reproductor" onclick="App.showSection('reproductor')">Reproductor</a>
    </div>
    
    <section id="heroBanner">
        <div class="hero-content">
            <h1 class="hero-title" id="heroTitle">Cargando‚Ä¶</h1>
            <p class="hero-description" id="heroDescription">Buscando contenido‚Ä¶</p>
            <div class="hero-buttons">
                <a class="play-btn" id="heroPlayBtn" tabindex="0">‚ñ∂ Reproducir</a>
            </div>
        </div>
    </section>
    
    <div id="main-content-wrapper">
        <section id="section-inicio" class="content-section"></section>
        <section id="section-historial" class="content-section hidden"></section>
        <section id="section-reproductor" class="content-section hidden">
            <!-- Reproductor Universal Integrado -->
            <div class="ultra-player">
                <!-- Header del Reproductor -->
                <div class="player-header">
                    <div class="header-content">
                        <div class="player-logo">
                            <div class="logo-icon">üé¨</div>
                            <div class="logo-text">
                                <h1>Stream Player TV</h1>
                                <p>Reproduce TODO - Sin instalaciones</p>
                            </div>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-secondary" onclick="App.showSection('inicio')">
                                <i class="fas fa-arrow-left"></i> Volver al Inicio
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Layout principal del reproductor -->
                <div class="player-layout">
                    <!-- Sidebar izquierdo - Playlist -->
                    <div class="sidebar-left" id="sidebarLeft">
                        <h3 class="sidebar-title">
                            <i class="fas fa-list-ul"></i> Lista de Reproducci√≥n
                        </h3>
                        <div class="playlist" id="playlist">
                            <!-- Items se cargar√°n din√°micamente -->
                        </div>
                    </div>

                    <!-- √Årea central - Video -->
                    <div class="video-container">
                        <video id="mainVideo" crossorigin="anonymous"></video>
                        
                        <div class="loading-overlay" id="loadingOverlay">
                            <div class="loading-spinner"></div>
                            <div class="loading-text" id="loadingText">Cargando...</div>
                        </div>
                    </div>

                    <!-- Sidebar derecho - Info y herramientas -->
                    <div class="sidebar-right" id="sidebarRight">
                        <h3 class="sidebar-title">
                            <i class="fas fa-info-circle"></i> Informaci√≥n
                        </h3>
                        
                        <div class="info-item">
                            <div class="info-label">Formato</div>
                            <div class="info-value" id="formatInfo">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Resoluci√≥n</div>
                            <div class="info-value" id="resolution">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Estado</div>
                            <div class="info-value" id="statusInfo">
                                <i class="fas fa-circle"></i> Listo
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Buffer</div>
                            <div class="info-value" id="bufferInfo">0%</div>
                        </div>
                        
                        <h3 class="sidebar-title" style="margin-top: 20px;">
                            <i class="fas fa-tools"></i> Herramientas
                        </h3>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="takeScreenshot()">
                                <i class="fas fa-camera"></i> Captura
                            </button>
                            <button class="btn btn-secondary" onclick="toggleFullscreen()">
                                <i class="fas fa-expand"></i> Pantalla Completa
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Controles avanzados -->
                <div class="controls-container">
                    <!-- Barra de progreso -->
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar">
                            <div class="progress-buffer" id="progressBuffer"></div>
                            <div class="progress-played" id="progressPlayed"></div>
                        </div>
                    </div>

                    <!-- Controles principales -->
                    <div class="controls-main">
                        <button class="control-btn" onclick="previousTrack()">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="control-btn" onclick="seekBackward()">
                            <i class="fas fa-backward"></i>
                        </button>
                        <button class="control-btn" onclick="playPause()" id="playPauseBtn">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="control-btn" onclick="seekForward()">
                            <i class="fas fa-forward"></i>
                        </button>
                        <button class="control-btn" onclick="nextTrack()">
                            <i class="fas fa-step-forward"></i>
                        </button>
                        
                        <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
                        
                        <div class="volume-control" style="display: flex; align-items: center; gap: 10px; margin-left: auto;">
                            <button class="control-btn" onclick="toggleMute()" id="muteBtn">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <input type="range" class="volume-slider" id="volumeSlider" 
                                   min="0" max="100" value="70">
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Notificaciones -->
    <div class="notification" id="notification">
        <div class="notification-title" id="notificationTitle">T√≠tulo</div>
        <div class="notification-message" id="notificationMessage">Mensaje</div>
    </div>

    <script>
        // ========== CONFIGURACI√ìN DEL INDEX ==========
        const CONFIG = { 
            PLAYLIST_URL: "https://raw.githubusercontent.com/Miguel179-spe/tvlion/refs/heads/peliculas/peliculas.html", 
            STORAGE_KEYS: { 
                HISTORY: "tv_history_v11", 
                PROGRESS: "tv_progress_v11", 
                CACHE: "tv_cache_v11" 
            } 
        };
        
        const State = { 
            movies: [], 
            heroMovies: [], 
            currentHero: 0, 
            focusable: [], 
            focusIndex: 0,
            isFullscreen: false
        };
        
        const Storage = { 
            get: k => { 
                try { 
                    return JSON.parse(localStorage.getItem(k)); 
                } catch { 
                    return null; 
                } 
            }, 
            set: (k, v) => { 
                try { 
                    localStorage.setItem(k, JSON.stringify(v)); 
                } catch (e) {} 
            }, 
            getHistory: () => Storage.get(CONFIG.STORAGE_KEYS.HISTORY) || [] 
        };
        
        const Parser = { 
            parseM3U(t) { 
                return t.split('#EXTINF').slice(1).map(e => { 
                    const p = e.split('\n'); 
                    const m = p[0]; 
                    const u = p.slice(1).find(l => l.trim() && !l.startsWith('#'))?.trim(); 
                    if (!u) return null; 
                    return { 
                        title: (m.split(',').pop() || '').trim(), 
                        logo: (m.match(/tvg-logo="([^"]*)"/)?.[1] || '').trim(), 
                        group: (m.match(/group-title="([^"]*)"/)?.[1] || 'Otros').trim(), 
                        url: u 
                    }; 
                }).filter(Boolean); 
            } 
        };

        const Renderer = { 
            createMovieCard(movie) {
                const card = document.createElement('a');
                card.className = 'movie-card';
                card.tabIndex = 0;
                
                // Al hacer clic, cargar en el reproductor y activar pantalla completa
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    // Guardar en historial
                    const history = Storage.getHistory().filter(x => x.url !== movie.url);
                    Storage.set(CONFIG.STORAGE_KEYS.HISTORY, [movie, ...history].slice(0, 50));
                    
                    // Cargar en el reproductor
                    Player.loadMedia(movie.url, movie.title);
                    
                    // Mostrar secci√≥n del reproductor
                    App.showSection('reproductor');
                    
                    // Activar pantalla completa autom√°ticamente
                    setTimeout(() => {
                        FullscreenManager.activateFullscreen();
                    }, 500);
                });

                const progress = Storage.get(CONFIG.STORAGE_KEYS.PROGRESS)?.[movie.url];
                const pHTML = progress?.progress > 5 && progress.progress < 95 ? 
                    `<div class="progress-indicator" style="width:${progress.progress}%"></div>` : '';
                
                card.innerHTML = `
                    <img src="${movie.logo || ''}" alt="${movie.title}">
                    <div class="title">${movie.title}</div>
                    ${pHTML}
                `;
                return card;
            },
            
            renderCategories(byCategory) { 
                const f = document.createDocumentFragment(); 
                for (const [cat, movs] of Object.entries(byCategory)) { 
                    const s = document.createElement('div'); 
                    s.innerHTML=`<h2 class="section-title">${cat}</h2>`; 
                    const c = document.createElement('div'); 
                    c.className='container-carrusel'; 
                    c.setAttribute('data-category',cat); 
                    for(const mov of movs) c.appendChild(this.createMovieCard(mov)); 
                    s.appendChild(c); 
                    f.appendChild(s); 
                } 
                document.getElementById('section-inicio').innerHTML = ''; 
                document.getElementById('section-inicio').appendChild(f); 
            },
            
            renderHistory() { 
                const h = Storage.getHistory(); 
                const c = document.getElementById('section-historial'); 
                if (!h || h.length === 0) { 
                    c.innerHTML = '<h2 class="section-title">Seguir viendo</h2><p style="padding:0 var(--gutter);">Nada en el historial.</p>'; 
                    return; 
                } 
                const car = document.createElement('div'); 
                car.className='container-carrusel'; 
                for(const mov of h) car.appendChild(this.createMovieCard(mov)); 
                c.innerHTML='<h2 class="section-title">Seguir viendo</h2>'; 
                c.appendChild(car); 
            }
        };
        
        const Hero = {
            timer: null,
            update() {
                const movs = State.heroMovies; 
                if (!movs.length) return;
                
                const mov = movs[State.currentHero % movs.length];
                document.getElementById('heroBanner').style.backgroundImage = `url('${mov.logo}')`;
                document.getElementById('heroTitle').textContent = mov.title;
                document.getElementById('heroDescription').textContent = mov.group;
                
                const playBtn = document.getElementById('heroPlayBtn');
                playBtn.onclick = () => {
                    // Guardar en historial
                    const history = Storage.getHistory().filter(x => x.url !== mov.url);
                    Storage.set(CONFIG.STORAGE_KEYS.HISTORY, [mov, ...history].slice(0, 50));
                    
                    // Cargar en el reproductor
                    Player.loadMedia(mov.url, mov.title);
                    
                    // Mostrar secci√≥n del reproductor
                    App.showSection('reproductor');
                    
                    // Activar pantalla completa autom√°ticamente
                    setTimeout(() => {
                        FullscreenManager.activateFullscreen();
                    }, 500);
                };
                
                State.currentHero = (State.currentHero + 1) % movs.length;
            },
            
            start() { 
                this.stop(); 
                this.update(); 
                this.timer = setInterval(this.update, 8000); 
            },
            
            stop() { 
                clearInterval(this.timer); 
            }
        };

        const Navigation = {
            updateFocusable() { 
                const active = document.querySelector('.content-section:not(.hidden)'); 
                if (!active) { 
                    State.focusable = []; 
                    return; 
                } 
                State.focusable = [
                    ...document.querySelectorAll('.navbar a'), 
                    ...(active.id === 'section-inicio' ? [document.getElementById('heroPlayBtn')] : []), 
                    ...active.querySelectorAll('a.movie-card')
                ]; 
            },
            
            setFocus(index) { 
                State.focusIndex = index; 
                const el = State.focusable[State.focusIndex]; 
                if(el) el.focus(); 
            },
            
            activateFocused() { 
                State.focusable[State.focusIndex]?.click(); 
            },
            
            moveFocus(direction) {
                if (!State.focusable.length) return;
                const current = State.focusable[State.focusIndex];
                if (!current) return;
                
                const rect = current.getBoundingClientRect();
                let bestCandidate = -1, minDistance = Infinity;
                
                State.focusable.forEach((target, i) => {
                    if (i === State.focusIndex) return;
                    const targetRect = target.getBoundingClientRect();
                    const dx = targetRect.left + targetRect.width / 2 - (rect.left + rect.width / 2);
                    const dy = targetRect.top + targetRect.height / 2 - (rect.top + rect.height / 2);
                    
                    let isValid = false, distance = Infinity;
                    
                    if (direction === 'Right' && dx > 5 && Math.abs(dy) < rect.height * 1.5) { 
                        isValid = true; 
                        distance = Math.sqrt(dx*dx + dy*dy*0.5); 
                    }
                    else if (direction === 'Left' && dx < -5 && Math.abs(dy) < rect.height * 1.5) { 
                        isValid = true; 
                        distance = Math.sqrt(dx*dx + dy*dy*0.5); 
                    }
                    else if (direction === 'Down' && dy > 5) { 
                        isValid = true; 
                        distance = Math.sqrt(dx*dx*0.1 + dy*dy); 
                    }
                    else if (direction === 'Up' && dy < -5) { 
                        isValid = true; 
                        distance = Math.sqrt(dx*dx*0.1 + dy*dy); 
                    }
                    
                    if (isValid && distance < minDistance) { 
                        minDistance = distance; 
                        bestCandidate = i; 
                    }
                });
                
                if (bestCandidate !== -1) { 
                    State.focusIndex = bestCandidate; 
                    const el = State.focusable[State.focusIndex]; 
                    if (el) { 
                        el.focus(); 
                        el.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }); 
                    } 
                }
            }
        };

        // ========== GESTOR DE PANTALLA COMPLETA ==========
        const FullscreenManager = {
            isActive: false,
            
            activateFullscreen() {
                if (this.isActive) return;
                
                const reproductorSection = document.getElementById('section-reproductor');
                if (!reproductorSection) return;
                
                // Mostrar mensaje de pantalla completa
                const overlay = document.getElementById('fullscreenOverlay');
                if (overlay) {
                    overlay.classList.remove('hidden');
                    
                    // Ocultar mensaje despu√©s de 2 segundos
                    setTimeout(() => {
                        overlay.classList.add('hidden');
                    }, 2000);
                }
                
                // Aplicar clase de pantalla completa
                reproductorSection.classList.add('fullscreen-mode');
                
                // Intentar entrar en pantalla completa nativa
                const element = document.documentElement;
                if (element.requestFullscreen) {
                    element.requestFullscreen().catch(err => {
                        console.log('Error al intentar pantalla completa:', err);
                    });
                } else if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen();
                } else if (element.mozRequestFullScreen) {
                    element.mozRequestFullScreen();
                } else if (element.msRequestFullscreen) {
                    element.msRequestFullscreen();
                }
                
                this.isActive = true;
                State.isFullscreen = true;
                
                // Reproducir el video si est√° pausado
                if (Player.video && Player.video.paused) {
                    Player.video.play().catch(e => console.log('Error al reproducir:', e));
                }
                
                Player.showNotification('Pantalla Completa', 'Modo pantalla completa activado. Presiona ESC para salir.', 'success');
            },
            
            deactivateFullscreen() {
                if (!this.isActive) return;
                
                const reproductorSection = document.getElementById('section-reproductor');
                if (reproductorSection) {
                    reproductorSection.classList.remove('fullscreen-mode');
                }
                
                // Salir de pantalla completa nativa
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                
                this.isActive = false;
                State.isFullscreen = false;
                
                Player.showNotification('Pantalla Completa', 'Modo pantalla completa desactivado.', 'info');
            },
            
            toggleFullscreen() {
                if (this.isActive) {
                    this.deactivateFullscreen();
                } else {
                    this.activateFullscreen();
                }
            },
            
            init() {
                // Escuchar cambios en el estado de pantalla completa
                document.addEventListener('fullscreenchange', () => {
                    if (!document.fullscreenElement) {
                        this.deactivateFullscreen();
                    }
                });
                
                document.addEventListener('webkitfullscreenchange', () => {
                    if (!document.webkitFullscreenElement) {
                        this.deactivateFullscreen();
                    }
                });
                
                document.addEventListener('mozfullscreenchange', () => {
                    if (!document.mozFullScreenElement) {
                        this.deactivateFullscreen();
                    }
                });
                
                document.addEventListener('MSFullscreenChange', () => {
                    if (!document.msFullscreenElement) {
                        this.deactivateFullscreen();
                    }
                });
                
                // Tecla Escape para salir de pantalla completa
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isActive) {
                        this.deactivateFullscreen();
                    }
                });
            }
        };

        const App = {
            init() {
                document.addEventListener('keydown', e => {
                    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) { 
                        e.preventDefault(); 
                        Navigation.moveFocus(e.key.replace('Arrow', '')); 
                    }
                    else if (e.key === 'Enter') { 
                        e.preventDefault(); 
                        Navigation.activateFocused(); 
                    }
                    else if (e.key === 'Backspace') { 
                        e.preventDefault(); 
                        if (document.getElementById('section-historial').classList.contains('hidden') && 
                            document.getElementById('section-reproductor').classList.contains('hidden')) return;
                        this.showSection('inicio'); 
                    }
                });
                
                window.addEventListener('pageshow', (event) => { 
                    if (event.persisted) { 
                        console.log('P√°gina restaurada desde bfcache.'); 
                        this.showSection('inicio');
                    } 
                });
                
                // Inicializar el reproductor
                Player.init();
                
                // Inicializar gestor de pantalla completa
                FullscreenManager.init();
                
                // Cargar pel√≠culas
                this.loadMovies();
            },
            
            showSection(id) {
                // Si estamos en pantalla completa, salir al cambiar de secci√≥n
                if (State.isFullscreen && id !== 'reproductor') {
                    FullscreenManager.deactivateFullscreen();
                }
                
                // Ocultar todas las secciones
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Mostrar la secci√≥n seleccionada
                document.getElementById(`section-${id}`).classList.remove('hidden');
                
                // Actualizar navegaci√≥n
                document.getElementById('link-inicio').classList.toggle('active', id === 'inicio');
                document.getElementById('link-historial').classList.toggle('active', id === 'historial');
                document.getElementById('link-reproductor').classList.toggle('active', id === 'reproductor');
                
                // Controlar el hero banner
                if (id === 'inicio') {
                    Hero.start();
                } else {
                    Hero.stop();
                    
                    if (id === 'historial') {
                        Renderer.renderHistory();
                    }
                }
                
                Navigation.updateFocusable();
                Navigation.setFocus(0);
            },
            
            async loadMovies() {
                document.getElementById('section-inicio').innerHTML = `
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <div>Cargando contenido...</div>
                    </div>
                `;
                
                const cached = Storage.get(CONFIG.STORAGE_KEYS.CACHE);
                if (cached?.data && (Date.now() - cached.timestamp < 3600000)) {
                    return this.processMovies(cached.data);
                }
                
                try {
                    const response = await fetch(CONFIG.PLAYLIST_URL);
                    if (!response.ok) throw new Error(`Red ${response.status}`);
                    
                    const text = await response.text();
                    const movies = Parser.parseM3U(text);
                    
                    if (!movies.length) throw new Error('Lista vac√≠a');
                    
                    Storage.set(CONFIG.STORAGE_KEYS.CACHE, { 
                        data: movies, 
                        timestamp: Date.now() 
                    });
                    
                    this.processMovies(movies);
                } catch (error) {
                    document.getElementById('section-inicio').innerHTML = `
                        <div class="error-state">
                            ‚ùå Error al cargar el contenido
                        </div>
                    `;
                    console.error('Error loading movies:', error);
                }
            },
            
            processMovies(movies) {
                State.movies = movies;
                State.heroMovies = movies.slice(0, 5);
                
                const byCategory = movies.reduce((acc, movie) => {
                    (acc[movie.group] = acc[movie.group] || []).push(movie);
                    return acc;
                }, {});
                
                Renderer.renderCategories(byCategory);
                this.showSection('inicio');
            }
        };

        // ========== REPRODUCTOR UNIVERSAL ==========
        const Player = {
            video: null,
            currentPlayer: null,
            playerType: null,
            playlist: [],
            currentIndex: 0,
            
            init() {
                this.video = document.getElementById('mainVideo');
                if (!this.video) return;
                
                // Configurar event listeners del video
                this.video.addEventListener('loadedmetadata', () => this.updateMediaInfo());
                this.video.addEventListener('timeupdate', () => this.updateProgress());
                this.video.addEventListener('progress', () => this.updateBuffer());
                this.video.addEventListener('play', () => this.updatePlayButton(true));
                this.video.addEventListener('pause', () => this.updatePlayButton(false));
                this.video.addEventListener('ended', () => this.handleVideoEnded());
                this.video.addEventListener('error', (e) => this.handleVideoError(e));
                
                // Configurar controles de volumen
                const volumeSlider = document.getElementById('volumeSlider');
                if (volumeSlider) {
                    volumeSlider.addEventListener('input', (e) => {
                        this.video.volume = e.target.value / 100;
                        this.updateVolumeIcon();
                    });
                }
                
                // Configurar barra de progreso
                const progressContainer = document.getElementById('progressContainer');
                if (progressContainer) {
                    progressContainer.addEventListener('click', (e) => {
                        const rect = progressContainer.getBoundingClientRect();
                        const percent = (e.clientX - rect.left) / rect.width;
                        this.video.currentTime = percent * this.video.duration;
                    });
                }
                
                console.log('Reproductor inicializado correctamente');
            },
            
            async loadMedia(url, title = 'Sin t√≠tulo') {
                if (!this.video) return;
                
                this.cleanupCurrentPlayer();
                this.showLoading(true, 'Cargando...');
                
                try {
                    const format = this.detectFormat(url);
                    
                    switch(format) {
                        case 'hls':
                        case 'm3u8':
                            await this.loadHLS(url);
                            break;
                        case 'dash':
                        case 'mpd':
                            await this.loadDASH(url);
                            break;
                        case 'flv':
                            await this.loadFLV(url);
                            break;
                        case 'mpegts':
                            await this.loadMPEGTS(url);
                            break;
                        default:
                            await this.loadNative(url);
                    }
                    
                    // Agregar a playlist
                    this.addToPlaylist({
                        url: url,
                        title: title,
                        format: format
                    });
                    
                    this.updateStatus('Reproduciendo');
                    this.showNotification('√âxito', 'Contenido cargado correctamente', 'success');
                } catch (error) {
                    console.error('Error loading media:', error);
                    this.showNotification('Error', error.message, 'error');
                    this.updateStatus('Error');
                } finally {
                    this.showLoading(false);
                }
            },
            
            detectFormat(url) {
                const lower = url.toLowerCase();
                
                if (lower.includes('.m3u8')) return 'hls';
                if (lower.includes('.mpd')) return 'dash';
                if (lower.includes('.flv')) return 'flv';
                if (lower.includes('.ts') || lower.includes('.mts')) return 'mpegts';
                if (lower.includes('.mp4')) return 'mp4';
                if (lower.includes('.webm')) return 'webm';
                if (lower.includes('.mkv')) return 'mkv';
                
                return 'unknown';
            },
            
            async loadHLS(url) {
                if (Hls.isSupported()) {
                    this.currentPlayer = new Hls({
                        debug: false,
                        enableWorker: true,
                        lowLatencyMode: true
                    });
                    
                    this.currentPlayer.loadSource(url);
                    this.currentPlayer.attachMedia(this.video);
                    this.playerType = 'hls';
                    
                    this.currentPlayer.on(Hls.Events.MANIFEST_PARSED, () => {
                        this.video.play();
                    });
                } else if (this.video.canPlayType('application/vnd.apple.mpegurl')) {
                    // Safari nativo
                    this.video.src = url;
                    this.video.play();
                    this.playerType = 'native-hls';
                } else {
                    throw new Error('HLS no soportado en este navegador');
                }
            },
            
            async loadDASH(url) {
                if (typeof dashjs !== 'undefined') {
                    this.currentPlayer = dashjs.MediaPlayer().create();
                    this.currentPlayer.initialize(this.video, url, true);
                    this.playerType = 'dash';
                } else if (typeof shaka !== 'undefined') {
                    await this.loadShaka(url);
                } else {
                    throw new Error('DASH no disponible');
                }
            },
            
            async loadShaka(url) {
                shaka.polyfill.installAll();
                
                if (shaka.Player.isBrowserSupported()) {
                    this.currentPlayer = new shaka.Player(this.video);
                    this.playerType = 'shaka';
                    
                    try {
                        await this.currentPlayer.load(url);
                        this.video.play();
                    } catch (e) {
                        throw new Error('Error con Shaka: ' + e.message);
                    }
                } else {
                    throw new Error('Navegador no soportado por Shaka');
                }
            },
            
            async loadFLV(url) {
                if (flvjs && flvjs.isSupported()) {
                    this.currentPlayer = flvjs.createPlayer({
                        type: 'flv',
                        url: url,
                        isLive: false
                    });
                    
                    this.currentPlayer.attachMediaElement(this.video);
                    this.currentPlayer.load();
                    this.currentPlayer.play();
                    this.playerType = 'flv';
                } else {
                    throw new Error('FLV no soportado');
                }
            },
            
            async loadMPEGTS(url) {
                if (typeof mpegts !== 'undefined' && mpegts.isSupported()) {
                    this.currentPlayer = mpegts.createPlayer({
                        type: 'mse',
                        isLive: false,
                        url: url
                    });
                    
                    this.currentPlayer.attachMediaElement(this.video);
                    this.currentPlayer.load();
                    this.currentPlayer.play();
                    this.playerType = 'mpegts';
                } else {
                    throw new Error('MPEG-TS no soportado');
                }
            },
            
            async loadNative(url) {
                this.video.src = url;
                this.video.load();
                await this.video.play();
                this.playerType = 'native';
            },
            
            addToPlaylist(item) {
                this.playlist.push(item);
                this.renderPlaylist();
            },
            
            renderPlaylist() {
                const container = document.getElementById('playlist');
                if (!container) return;
                
                container.innerHTML = '';
                
                this.playlist.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'playlist-item';
                    if (index === this.currentIndex) {
                        div.classList.add('active');
                    }
                    
                    div.innerHTML = `
                        <div class="item-thumbnail">
                            ${this.getFormatIcon(item.format)}
                        </div>
                        <div>
                            <div class="item-name">${item.title}</div>
                            <div class="item-details">
                                <span>${item.format.toUpperCase()}</span>
                            </div>
                        </div>
                    `;
                    
                    div.onclick = () => this.playItem(index);
                    container.appendChild(div);
                });
            },
            
            getFormatIcon(format) {
                const icons = {
                    'hls': 'üìä',
                    'dash': 'üìà',
                    'mp4': 'üìπ',
                    'webm': 'üé¨',
                    'mkv': 'üéûÔ∏è',
                    'flv': 'üìº',
                    'unknown': 'üìÅ'
                };
                return icons[format] || icons['unknown'];
            },
            
            playItem(index) {
                this.currentIndex = index;
                const item = this.playlist[index];
                this.loadMedia(item.url, item.title);
            },
            
            // Controles del reproductor
            playPause() {
                if (this.video.paused) {
                    this.video.play();
                } else {
                    this.video.pause();
                }
            },
            
            seekBackward() {
                this.video.currentTime = Math.max(0, this.video.currentTime - 10);
            },
            
            seekForward() {
                this.video.currentTime = Math.min(this.video.duration, this.video.currentTime + 10);
            },
            
            previousTrack() {
                if (this.currentIndex > 0) {
                    this.playItem(this.currentIndex - 1);
                }
            },
            
            nextTrack() {
                if (this.currentIndex < this.playlist.length - 1) {
                    this.playItem(this.currentIndex + 1);
                }
            },
            
            toggleMute() {
                this.video.muted = !this.video.muted;
                this.updateVolumeIcon();
            },
            
            toggleFullscreen() {
                FullscreenManager.toggleFullscreen();
            },
            
            // UI Helpers
            showLoading(show, text = 'Cargando...') {
                const overlay = document.getElementById('loadingOverlay');
                const loadingText = document.getElementById('loadingText');
                
                if (overlay) {
                    overlay.classList.toggle('active', show);
                }
                if (loadingText) {
                    loadingText.textContent = text;
                }
            },
            
            showNotification(title, message, type = 'success') {
                const notification = document.getElementById('notification');
                const titleEl = document.getElementById('notificationTitle');
                const messageEl = document.getElementById('notificationMessage');
                
                if (!notification || !titleEl || !messageEl) return;
                
                titleEl.textContent = title;
                messageEl.textContent = message;
                notification.className = `notification ${type} active`;
                
                setTimeout(() => {
                    notification.classList.remove('active');
                }, 5000);
            },
            
            updateStatus(status) {
                const statusEl = document.getElementById('statusInfo');
                if (!statusEl) return;
                
                statusEl.innerHTML = `<i class="fas fa-circle"></i> ${status}`;
                
                if (status.includes('Error')) {
                    statusEl.style.color = '#ff3366';
                } else if (status.includes('Cargando')) {
                    statusEl.style.color = '#ffaa00';
                } else {
                    statusEl.style.color = '#00ff88';
                }
            },
            
            updatePlayButton(isPlaying) {
                const icon = document.querySelector('#playPauseBtn i');
                if (icon) {
                    icon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
                }
            },
            
            updateVolumeIcon() {
                const icon = document.querySelector('#muteBtn i');
                if (!icon) return;
                
                if (this.video.muted || this.video.volume === 0) {
                    icon.className = 'fas fa-volume-mute';
                } else if (this.video.volume < 0.5) {
                    icon.className = 'fas fa-volume-down';
                } else {
                    icon.className = 'fas fa-volume-up';
                }
            },
            
            updateProgress() {
                if (this.video.duration) {
                    const percent = (this.video.currentTime / this.video.duration) * 100;
                    const progressPlayed = document.getElementById('progressPlayed');
                    if (progressPlayed) {
                        progressPlayed.style.width = percent + '%';
                    }
                    
                    const current = this.formatTime(this.video.currentTime);
                    const total = this.formatTime(this.video.duration);
                    const timeDisplay = document.getElementById('timeDisplay');
                    if (timeDisplay) {
                        timeDisplay.textContent = `${current} / ${total}`;
                    }
                }
            },
            
            updateBuffer() {
                if (this.video.buffered.length > 0) {
                    const buffered = this.video.buffered.end(this.video.buffered.length - 1);
                    const percent = (buffered / this.video.duration) * 100;
                    const progressBuffer = document.getElementById('progressBuffer');
                    if (progressBuffer) {
                        progressBuffer.style.width = percent + '%';
                    }
                    
                    const bufferInfo = document.getElementById('bufferInfo');
                    if (bufferInfo) {
                        bufferInfo.textContent = Math.round(percent) + '%';
                    }
                }
            },
            
            updateMediaInfo() {
                // Resoluci√≥n
                if (this.video.videoWidth && this.video.videoHeight) {
                    const resolution = document.getElementById('resolution');
                    if (resolution) {
                        resolution.textContent = `${this.video.videoWidth}x${this.video.videoHeight}`;
                    }
                }
                
                // Formato detectado
                const formatInfo = document.getElementById('formatInfo');
                if (formatInfo) {
                    formatInfo.textContent = this.playerType || 'Native';
                }
            },
            
            formatTime(seconds) {
                if (!isFinite(seconds)) return '--:--';
                
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            },
            
            cleanupCurrentPlayer() {
                if (this.currentPlayer) {
                    switch(this.playerType) {
                        case 'hls':
                            this.currentPlayer.destroy();
                            break;
                        case 'dash':
                            this.currentPlayer.reset();
                            break;
                        case 'shaka':
                            this.currentPlayer.destroy();
                            break;
                        case 'flv':
                        case 'mpegts':
                            this.currentPlayer.pause();
                            this.currentPlayer.unload();
                            this.currentPlayer.detachMediaElement();
                            this.currentPlayer.destroy();
                            break;
                    }
                    this.currentPlayer = null;
                    this.playerType = null;
                }
                
                if (this.video) {
                    this.video.pause();
                    this.video.removeAttribute('src');
                    this.video.load();
                }
            },
            
            handleVideoEnded() {
                this.updateStatus('Finalizado');
            },
            
            handleVideoError(e) {
                const error = e.target.error;
                let message = 'Error desconocido';
                
                if (error) {
                    switch(error.code) {
                        case error.MEDIA_ERR_ABORTED:
                            message = 'Reproducci√≥n abortada';
                            break;
                        case error.MEDIA_ERR_NETWORK:
                            message = 'Error de red';
                            break;
                        case error.MEDIA_ERR_DECODE:
                            message = 'Error de decodificaci√≥n';
                            break;
                        case error.MEDIA_ERR_SRC_NOT_SUPPORTED:
                            message = 'Formato no soportado';
                            break;
                    }
                }
                
                this.showNotification('Error de reproducci√≥n', message, 'error');
                this.updateStatus('Error');
            }
        };

        // Funciones globales para los controles
        function playPause() { Player.playPause(); }
        function seekBackward() { Player.seekBackward(); }
        function seekForward() { Player.seekForward(); }
        function previousTrack() { Player.previousTrack(); }
        function nextTrack() { Player.nextTrack(); }
        function toggleMute() { Player.toggleMute(); }
        function toggleFullscreen() { Player.toggleFullscreen(); }
        function takeScreenshot() { 
            Player.showNotification('Captura', 'Funci√≥n en desarrollo', 'info'); 
        }

        // Inicializar la aplicaci√≥n cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
