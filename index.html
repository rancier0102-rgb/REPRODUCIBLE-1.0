<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movies HD</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    font-family: -apple-system, sans-serif; 
    background: #000; 
    color: #fff; 
}
header {
    padding: 20px;
    background: #111;
    position: sticky;
    top: 0;
    z-index: 10;
    display: flex;
    gap: 20px;
    align-items: center;
}
h1 { 
    color: #e50914; 
    font-size: 1.5rem;
}
input {
    flex: 1;
    max-width: 400px;
    padding: 10px;
    border: none;
    border-radius: 5px;
    background: #222;
    color: #fff;
}
.counter {
    color: #888;
    font-size: 0.9rem;
}
.years {
    display: flex;
    gap: 10px;
    padding: 10px 20px;
    background: #111;
    overflow-x: auto;
}
.year-btn {
    padding: 5px 15px;
    background: #222;
    border: none;
    border-radius: 20px;
    color: #fff;
    cursor: pointer;
    white-space: nowrap;
}
.year-btn.active {
    background: #e50914;
}
main {
    padding: 20px;
}
.year-section {
    margin-bottom: 30px;
}
.year-title {
    font-size: 1.5rem;
    margin-bottom: 15px;
    color: #fff;
}
.movies {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
}
.movie {
    cursor: pointer;
    transition: transform 0.2s;
    position: relative;
    background: #111;
    border-radius: 5px;
    overflow: hidden;
}
.movie:hover {
    transform: scale(1.05);
}
.movie img {
    width: 100%;
    height: 225px;
    object-fit: cover;
    display: block;
}
.movie-title {
    padding: 8px;
    font-size: 0.85rem;
    line-height: 1.2;
}
.loading {
    text-align: center;
    padding: 50px;
    color: #666;
}
.empty {
    text-align: center;
    padding: 100px 20px;
    color: #666;
}
@media (max-width: 600px) {
    .movies { 
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
    }
    .movie img { height: 150px; }
    h1 { font-size: 1.2rem; }
}
</style>
</head>
<body>

<header>
    <h1>MOVIES+</h1>
    <input type="text" id="search" placeholder="Buscar...">
    <span class="counter" id="counter">0</span>
</header>

<div class="years" id="years">
    <button class="year-btn active" data-year="all">Todos</button>
</div>

<main id="main">
    <div class="loading">Cargando...</div>
</main>

<script>
// CONFIGURACIÓN - CAMBIA ESTOS VALORES
const CONFIG = {
    github_user: 'rancier0102',      // <-- CAMBIA
    github_repo: 'REPRODUCIBLE-1.0',  // <-- CAMBIA
    github_branch: 'main'            // <-- CAMBIA si usas otra rama
};

// App minimalista
const app = {
    movies: [],
    filtered: [],
    
    async init() {
        // Generar años (2025 a 1940)
        const years = [];
        for(let y = 2025; y >= 1940; y--) years.push(y);
        
        // Cargar películas
        const promises = years.map(year => this.loadYear(year));
        await Promise.allSettled(promises);
        
        // Renderizar
        this.render();
        this.setupEvents();
        this.createYearButtons();
    },
    
    async loadYear(year) {
        try {
            const url = `https://raw.githubusercontent.com/${CONFIG.github_user}/${CONFIG.github_repo}/${CONFIG.github_branch}/peliculas_${year}.json`;
            const res = await fetch(url);
            if (!res.ok) return;
            
            const data = await res.json();
            const movies = Array.isArray(data) ? data : [data];
            
            movies.forEach(m => {
                if (m?.titulo && m?.enlace) {
                    // Extraer año del título si existe
                    const yearMatch = m.titulo.match(/\((\d{4})\)/);
                    const cleanTitle = m.titulo.replace(/\s*\(\d{4}\)\s*$/, '');
                    
                    this.movies.push({
                        titulo: cleanTitle || m.titulo,
                        poster: m.poster || `https://via.placeholder.com/300x450/222/666?text=${year}`,
                        year: yearMatch ? yearMatch[1] : (m.ano || year),
                        enlace: m.enlace
                    });
                }
            });
        } catch(e) {}
    },
    
    render(movies = this.movies) {
        if (movies.length === 0) {
            document.getElementById('main').innerHTML = '<div class="empty">No hay películas</div>';
            return;
        }
        
        // Agrupar por año
        const byYear = {};
        movies.forEach(m => {
            if (!byYear[m.year]) byYear[m.year] = [];
            byYear[m.year].push(m);
        });
        
        // Ordenar años descendente
        const years = Object.keys(byYear).sort((a,b) => b-a);
        
        // Generar HTML
        let html = '';
        years.forEach(year => {
            html += `<div class="year-section">
                <h2 class="year-title">${year}</h2>
                <div class="movies">`;
            
            byYear[year].forEach(movie => {
                html += `<div class="movie" onclick="window.open('${movie.enlace}','_blank')">
                    <img src="${movie.poster}" loading="lazy" alt="${movie.titulo}">
                    <div class="movie-title">${movie.titulo}</div>
                </div>`;
            });
            
            html += '</div></div>';
        });
        
        document.getElementById('main').innerHTML = html;
        document.getElementById('counter').textContent = movies.length;
    },
    
    setupEvents() {
        // Búsqueda
        let timeout;
        document.getElementById('search').addEventListener('input', (e) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                const query = e.target.value.toLowerCase();
                if (!query) {
                    this.render();
                } else {
                    const filtered = this.movies.filter(m => 
                        m.titulo.toLowerCase().includes(query) || 
                        m.year.toString().includes(query)
                    );
                    this.render(filtered);
                }
            }, 300);
        });
    },
    
    createYearButtons() {
        // Obtener años únicos
        const years = [...new Set(this.movies.map(m => m.year))].sort((a,b) => b-a);
        
        // Crear botones para años con contenido
        const container = document.getElementById('years');
        years.slice(0, 10).forEach(year => {
            const btn = document.createElement('button');
            btn.className = 'year-btn';
            btn.dataset.year = year;
            btn.textContent = year;
            btn.onclick = () => this.filterByYear(year, btn);
            container.appendChild(btn);
        });
    },
    
    filterByYear(year, btn) {
        // Actualizar botones
        document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Filtrar
        if (year === 'all') {
            this.render();
        } else {
            const filtered = this.movies.filter(m => m.year == year);
            this.render(filtered);
        }
    }
};

// Iniciar
app.init();
</script>

</body>
</html>
