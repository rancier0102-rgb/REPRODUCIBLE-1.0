<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movies+ HD</title>

<style>
/* ============================================
   ESTILOS CR√çTICOS
   ============================================ */
:root {
  --primary: #e50914;
  --bg: #000;
  --card: #111;
  --text: #fff;
  --text-muted: #999;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
}

/* Loader */
.loader-container {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.3s;
}

.loader-container.hidden {
  opacity: 0;
  pointer-events: none;
}

.loader {
  width: 50px;
  height: 50px;
  border: 3px solid #333;
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loader-text {
  margin-top: 20px;
  color: var(--text-muted);
  font-size: 14px;
}

/* Header */
header {
  background: var(--card);
  border-bottom: 2px solid var(--primary);
  padding: 1rem;
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.logo {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--primary);
}

.search-box {
  flex: 1;
  min-width: 250px;
}

.search-input {
  width: 100%;
  padding: 0.75rem 1rem;
  background: rgba(255,255,255,0.05);
  border: 1px solid #333;
  border-radius: 25px;
  color: var(--text);
  font-size: 14px;
}

.search-input:focus {
  outline: none;
  border-color: var(--primary);
  background: rgba(255,255,255,0.1);
}

.stats {
  display: flex;
  gap: 1rem;
}

.stat {
  background: rgba(255,255,255,0.1);
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 13px;
}

.stat.primary {
  background: var(--primary);
  font-weight: 600;
}

/* Main */
.main-content {
  max-width: 1400px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

.movies-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 1rem;
}

.movie-card {
  background: var(--card);
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
}

.movie-card:hover {
  transform: scale(1.05);
  box-shadow: 0 5px 20px rgba(229, 9, 20, 0.4);
}

.movie-poster-container {
  position: relative;
  padding-bottom: 150%;
  background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
}

.movie-poster {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.movie-info {
  padding: 0.75rem;
}

.movie-title {
  font-size: 0.9rem;
  font-weight: 500;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.movie-year {
  font-size: 0.8rem;
  color: var(--text-muted);
  margin-top: 0.25rem;
}

.empty-state {
  text-align: center;
  padding: 4rem 1rem;
  color: var(--text-muted);
}

.error {
  background: #330000;
  color: #ff6666;
  padding: 1rem;
  margin: 1rem;
  border-radius: 8px;
  text-align: center;
}

@media (max-width: 768px) {
  .movies-grid {
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
  }
}
</style>
</head>
<body>

<!-- Loader -->
<div class="loader-container" id="loader">
  <div class="loader"></div>
  <p class="loader-text" id="loaderText">Cargando pel√≠culas...</p>
</div>

<!-- Header -->
<header>
  <div class="header-content">
    <div class="logo">üé¨ MOVIES+</div>
    <div class="search-box">
      <input 
        type="search" 
        class="search-input" 
        id="searchInput" 
        placeholder="Buscar pel√≠culas..."
        autocomplete="off">
    </div>
    <div class="stats">
      <div class="stat primary" id="movieCount">0 pel√≠culas</div>
      <div class="stat" id="status">Cargando...</div>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="main-content">
  <div class="movies-grid" id="moviesGrid"></div>
  <div class="empty-state" id="emptyState" style="display:none">
    <h2>No se encontraron pel√≠culas</h2>
    <p>Intenta con otro t√©rmino de b√∫squeda</p>
  </div>
  <div class="error" id="errorState" style="display:none"></div>
</main>

<script>
'use strict';

// ============================================
// CONFIGURACI√ìN - CAMBIAR ESTOS VALORES
// ============================================
const CONFIG = {
  // IMPORTANTE: Cambia estos valores por los tuyos
  GITHUB_USER: 'rancier0102-rgb',         // <-- TU USUARIO DE GITHUB
  GITHUB_REPO: 'REPRODUCIBLE-1.0',     // <-- TU REPOSITORIO
  GITHUB_BRANCH: 'main',              // <-- BRANCH (generalmente 'main' o 'master')
  
  // URLs autom√°ticas (no cambiar)
  get BASE_URL() {
    return `https://raw.githubusercontent.com/${this.GITHUB_USER}/${this.GITHUB_REPO}/${this.GITHUB_BRANCH}`;
  },
  
  get MANIFEST_URL() {
    return `${this.BASE_URL}/manifest.json`;
  },
  
  // Configuraci√≥n de cach√©
  USE_CACHE: true,
  CACHE_DURATION: 3600000, // 1 hora
  
  // UI
  RENDER_BATCH: 50
};

// ============================================
// APLICACI√ìN PRINCIPAL
// ============================================
class MoviesApp {
  constructor() {
    this.movies = [];
    this.filteredMovies = [];
    this.manifest = null;
    
    // Elementos DOM
    this.elements = {
      loader: document.getElementById('loader'),
      loaderText: document.getElementById('loaderText'),
      movieCount: document.getElementById('movieCount'),
      status: document.getElementById('status'),
      searchInput: document.getElementById('searchInput'),
      moviesGrid: document.getElementById('moviesGrid'),
      emptyState: document.getElementById('emptyState'),
      errorState: document.getElementById('errorState')
    };
    
    this.init();
  }
  
  async init() {
    console.log('üöÄ Iniciando Movies+');
    console.log('üìÅ Repositorio:', `${CONFIG.GITHUB_USER}/${CONFIG.GITHUB_REPO}`);
    
    try {
      // Paso 1: Cargar manifest
      await this.loadManifest();
      
      // Paso 2: Cargar chunks
      await this.loadChunks();
      
      // Paso 3: Renderizar
      this.render();
      
      // Paso 4: Configurar eventos
      this.setupEvents();
      
      // Ocultar loader
      this.hideLoader();
      
      console.log(`‚úÖ ${this.movies.length} pel√≠culas cargadas`);
      
    } catch (error) {
      console.error('‚ùå Error:', error);
      this.showError(`Error cargando pel√≠culas: ${error.message}`);
      this.hideLoader();
    }
  }
  
  async loadManifest() {
    this.updateLoader('Cargando cat√°logo...');
    
    // Intentar desde cach√©
    if (CONFIG.USE_CACHE) {
      const cached = this.getFromCache('manifest');
      if (cached) {
        console.log('üì¶ Manifest desde cach√©');
        this.manifest = cached;
        return;
      }
    }
    
    // Cargar desde GitHub
    console.log('üì• Cargando manifest desde:', CONFIG.MANIFEST_URL);
    
    try {
      const response = await fetch(CONFIG.MANIFEST_URL);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: No se pudo cargar el manifest`);
      }
      
      const text = await response.text();
      console.log('üìÑ Respuesta recibida, tama√±o:', text.length);
      
      this.manifest = JSON.parse(text);
      console.log('‚úÖ Manifest cargado:', this.manifest);
      
      // Guardar en cach√©
      if (CONFIG.USE_CACHE) {
        this.saveToCache('manifest', this.manifest);
      }
      
    } catch (error) {
      console.error('‚ùå Error cargando manifest:', error);
      
      // Fallback: intentar cargar directamente un chunk por defecto
      console.log('üîÑ Intentando fallback directo...');
      this.manifest = {
        chunks: [{
          id: 'all',
          file: 'chunks/all.json',
          movies: 0
        }]
      };
    }
  }
  
  async loadChunks() {
    if (!this.manifest || !this.manifest.chunks) {
      throw new Error('Manifest inv√°lido o sin chunks');
    }
    
    console.log(`üì¶ Cargando ${this.manifest.chunks.length} chunks...`);
    
    for (const chunkInfo of this.manifest.chunks) {
      this.updateLoader(`Cargando ${chunkInfo.id}...`);
      
      try {
        const chunkUrl = `${CONFIG.BASE_URL}/${chunkInfo.file}`;
        console.log(`üì• Cargando chunk: ${chunkUrl}`);
        
        // Intentar cach√© primero
        if (CONFIG.USE_CACHE) {
          const cached = this.getFromCache(`chunk_${chunkInfo.id}`);
          if (cached) {
            console.log(`‚úÖ Chunk ${chunkInfo.id} desde cach√©`);
            this.processChunk(cached);
            continue;
          }
        }
        
        // Cargar desde GitHub
        const response = await fetch(chunkUrl);
        
        if (!response.ok) {
          console.error(`‚ùå Error cargando chunk ${chunkInfo.id}: HTTP ${response.status}`);
          continue;
        }
        
        const chunkData = await response.json();
        console.log(`‚úÖ Chunk ${chunkInfo.id} cargado:`, chunkData);
        
        // Guardar en cach√©
        if (CONFIG.USE_CACHE) {
          this.saveToCache(`chunk_${chunkInfo.id}`, chunkData);
        }
        
        // Procesar chunk
        this.processChunk(chunkData);
        
      } catch (error) {
        console.error(`‚ùå Error procesando chunk ${chunkInfo.id}:`, error);
      }
    }
    
    console.log(`üìä Total de pel√≠culas cargadas: ${this.movies.length}`);
  }
  
  processChunk(chunkData) {
    // El chunk puede tener diferentes formatos
    let movies = [];
    
    if (chunkData.movies && Array.isArray(chunkData.movies)) {
      movies = chunkData.movies;
    } else if (Array.isArray(chunkData)) {
      movies = chunkData;
    } else if (chunkData.data && Array.isArray(chunkData.data)) {
      movies = chunkData.data;
    }
    
    // Procesar cada pel√≠cula
    movies.forEach(movie => {
      // Expandir campos comprimidos si es necesario
      const processedMovie = {
        titulo: movie.t || movie.titulo || movie.title || 'Sin t√≠tulo',
        enlace: movie.l || movie.enlace || movie.link || movie.url || '#',
        year: movie.y || movie.year || movie.ano || movie.a√±o || 2024,
        poster: movie.p || movie.poster || movie.image || this.getDefaultPoster(),
        genero: movie.g || movie.genero || movie.genre || '',
        calidad: movie.q || movie.calidad || movie.quality || ''
      };
      
      this.movies.push(processedMovie);
    });
    
    console.log(`üìä Pel√≠culas procesadas del chunk: ${movies.length}`);
  }
  
  render(moviesToRender = this.movies) {
    const grid = this.elements.moviesGrid;
    
    if (moviesToRender.length === 0) {
      grid.innerHTML = '';
      this.elements.emptyState.style.display = 'block';
      this.elements.errorState.style.display = 'none';
      return;
    }
    
    this.elements.emptyState.style.display = 'none';
    this.elements.errorState.style.display = 'none';
    
    // Limpiar grid
    grid.innerHTML = '';
    
    // Renderizar pel√≠culas
    const fragment = document.createDocumentFragment();
    
    moviesToRender.slice(0, CONFIG.RENDER_BATCH).forEach(movie => {
      const card = this.createMovieCard(movie);
      fragment.appendChild(card);
    });
    
    grid.appendChild(fragment);
    
    // Renderizar el resto en segundo plano
    if (moviesToRender.length > CONFIG.RENDER_BATCH) {
      setTimeout(() => {
        const restFragment = document.createDocumentFragment();
        moviesToRender.slice(CONFIG.RENDER_BATCH).forEach(movie => {
          const card = this.createMovieCard(movie);
          restFragment.appendChild(card);
        });
        grid.appendChild(restFragment);
      }, 100);
    }
    
    // Actualizar estad√≠sticas
    this.updateStats(moviesToRender.length);
  }
  
  createMovieCard(movie) {
    const card = document.createElement('article');
    card.className = 'movie-card';
    card.onclick = () => this.playMovie(movie);
    card.title = movie.titulo;
    
    card.innerHTML = `
      <div class="movie-poster-container">
        <img 
          class="movie-poster" 
          src="${movie.poster}" 
          alt="${movie.titulo}"
          loading="lazy"
          onerror="this.src='${this.getDefaultPoster()}'">
      </div>
      <div class="movie-info">
        <div class="movie-title">${movie.titulo}</div>
        <div class="movie-year">${movie.year}</div>
      </div>
    `;
    
    return card;
  }
  
  setupEvents() {
    // B√∫squeda
    let searchTimeout;
    this.elements.searchInput.addEventListener('input', (e) => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        this.search(e.target.value);
      }, 300);
    });
  }
  
  search(query) {
    query = query.toLowerCase().trim();
    
    if (!query) {
      this.filteredMovies = [];
      this.render(this.movies);
      return;
    }
    
    this.filteredMovies = this.movies.filter(movie => {
      return movie.titulo.toLowerCase().includes(query) ||
             movie.year.toString().includes(query) ||
             movie.genero.toLowerCase().includes(query);
    });
    
    this.render(this.filteredMovies);
  }
  
  playMovie(movie) {
    console.log('‚ñ∂Ô∏è Reproduciendo:', movie.titulo);
    if (movie.enlace && movie.enlace !== '#') {
      window.open(movie.enlace, '_blank');
    } else {
      alert('Enlace no disponible');
    }
  }
  
  updateLoader(text) {
    this.elements.loaderText.textContent = text;
  }
  
  hideLoader() {
    this.elements.loader.classList.add('hidden');
    setTimeout(() => {
      this.elements.loader.style.display = 'none';
    }, 300);
  }
  
  updateStats(count) {
    this.elements.movieCount.textContent = `${count} pel√≠culas`;
    this.elements.status.textContent = 'Listo';
  }
  
  showError(message) {
    this.elements.errorState.textContent = message;
    this.elements.errorState.style.display = 'block';
    this.elements.emptyState.style.display = 'none';
  }
  
  getDefaultPoster() {
    return 'data:image/svg+xml,' + encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="300" height="450" viewBox="0 0 300 450">
        <rect width="300" height="450" fill="#1a1a1a"/>
        <text x="150" y="225" font-family="Arial" font-size="20" fill="#666" text-anchor="middle">üé¨</text>
      </svg>
    `);
  }
  
  // Sistema de cach√© simple
  getFromCache(key) {
    if (!CONFIG.USE_CACHE) return null;
    
    try {
      const item = localStorage.getItem(key);
      if (!item) return null;
      
      const data = JSON.parse(item);
      if (Date.now() > data.expiry) {
        localStorage.removeItem(key);
        return null;
      }
      
      return data.value;
    } catch (e) {
      return null;
    }
  }
  
  saveToCache(key, value) {
    if (!CONFIG.USE_CACHE) return;
    
    try {
      const data = {
        value: value,
        expiry: Date.now() + CONFIG.CACHE_DURATION
      };
      localStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
      console.warn('No se pudo guardar en cach√©:', e);
    }
  }
}

// ============================================
// INICIAR APLICACI√ìN
// ============================================
window.addEventListener('DOMContentLoaded', () => {
  console.log('üé¨ DOM Cargado, iniciando aplicaci√≥n...');
  window.app = new MoviesApp();
});

// Debug helper
console.log('üìå Para debug, usa: window.app');
</script>

</body>
</html>
