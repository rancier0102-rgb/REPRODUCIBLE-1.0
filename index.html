<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Series+ - Plataforma de Streaming</title>
<style>
:root {
    --primary-color: #e50914;
    --background-dark: #141414;
    --background-card: #181818;
    --background-secondary: #222;
    --text-light: #fff;
    --muted: #b3b3b3;
    --radius: 8px;
    --transition: 0.25s ease;
    --focus-shadow: 0 0 25px rgba(229, 9, 20, 0.9);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: var(--background-dark);
    color: var(--text-light);
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* TV Optimization - Larger UI elements */
@media screen and (min-width: 1920px) {
    body {
        zoom: 1.1;
    }
}

@media screen and (min-width: 3840px) {
    body {
        zoom: 1.3;
    }
}

/* Loader */
.loader {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--primary-color);
    font-size: 1.8rem;
    z-index: 1000;
}

.loader.hidden {
    display: none;
}

/* HEADER */
header {
    padding: 18px 30px;
    background: linear-gradient(to bottom, rgba(20,20,20,0.98), rgba(20,20,20,0.95));
    position: sticky;
    top: 0;
    display: flex;
    gap: 25px;
    align-items: center;
    z-index: 10;
    backdrop-filter: blur(20px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    min-height: 70px;
}

.logo { 
    font-weight: bold; 
    font-size: 1.8rem;
    color: var(--primary-color);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    margin-right: 20px;
}

/* Professional Search Bar */
.search-container {
    flex: 1;
    max-width: 500px;
    position: relative;
}

.search-wrapper {
    position: relative;
    width: 100%;
}

.search-box {
    width: 100%;
    background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.05));
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 25px;
    padding: 12px 50px 12px 20px;
    color: white;
    font-size: 14px;
    font-weight: 400;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
}

.search-box::placeholder {
    color: rgba(255,255,255,0.4);
    font-weight: 300;
    letter-spacing: 0.5px;
}

.search-box:hover {
    background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08));
    border-color: rgba(255,255,255,0.15);
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.2), 0 0 20px rgba(255,255,255,0.05);
}

.search-box:focus {
    outline: none;
    background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.1));
    border-color: rgba(229, 9, 20, 0.5);
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.3), 0 0 30px rgba(229, 9, 20, 0.2);
    padding-left: 24px;
}

.search-box.focused {
    transform: translateY(-1px);
}

/* Search Icon */
.search-icon {
    position: absolute;
    right: 18px;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    pointer-events: none;
    opacity: 0.5;
    transition: all 0.3s ease;
}

.search-icon svg {
    width: 100%;
    height: 100%;
    fill: currentColor;
}

.search-box:focus ~ .search-icon {
    opacity: 0.8;
    right: 16px;
}

/* Search Clear Button */
.search-clear {
    position: absolute;
    right: 45px;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.search-clear:hover {
    background: rgba(255,255,255,0.2);
    transform: translateY(-50%) scale(1.1);
}

.search-clear.visible {
    display: flex;
}

/* Enhanced Search Results */
.search-results {
    position: absolute;
    top: calc(100% + 10px);
    left: 0;
    right: 0;
    background: linear-gradient(135deg, rgba(32,32,32,0.98), rgba(24,24,24,0.98));
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px;
    max-height: 400px;
    overflow-y: auto;
    display: none;
    backdrop-filter: blur(20px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.6), 0 5px 15px rgba(0,0,0,0.4);
    animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.search-results.active {
    display: block;
}

/* Custom Scrollbar for Search Results */
.search-results::-webkit-scrollbar {
    width: 6px;
}

.search-results::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 3px;
}

.search-results::-webkit-scrollbar-thumb {
    background: rgba(229, 9, 20, 0.5);
    border-radius: 3px;
}

.search-results::-webkit-scrollbar-thumb:hover {
    background: rgba(229, 9, 20, 0.7);
}

.search-result-item {
    padding: 12px 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    min-height: 70px;
}

.search-result-item:last-child {
    border-bottom: none;
}

.search-result-item:hover {
    background: linear-gradient(90deg, rgba(229, 9, 20, 0.15), transparent);
    padding-left: 20px;
}

.search-result-item.focused {
    background: linear-gradient(90deg, rgba(229, 9, 20, 0.25), rgba(229, 9, 20, 0.05));
    border-left: 3px solid var(--primary-color);
    padding-left: 13px;
}

.search-result-poster {
    width: 40px;
    height: 60px;
    object-fit: cover;
    border-radius: 4px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    transition: transform 0.2s ease;
}

.search-result-item:hover .search-result-poster {
    transform: scale(1.05);
}

.search-result-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.search-result-title {
    font-size: 14px;
    font-weight: 500;
    color: rgba(255,255,255,0.95);
}

.search-result-year {
    font-size: 12px;
    color: rgba(255,255,255,0.5);
}

.no-results {
    padding: 25px 20px;
    text-align: center;
    color: rgba(255,255,255,0.4);
    font-size: 14px;
}

/* CONTINUE WATCHING SECTION */
.continue-watching-section {
    padding: 25px 30px 15px;
    display: none;
}

.continue-watching-section.active {
    display: block;
}

.section-header {
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 15px;
    color: var(--text-light);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.clear-continue {
    font-size: 0.9rem;
    color: var(--muted);
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 18px;
    background: rgba(255,255,255,0.05);
    transition: all 0.2s ease;
}

.clear-continue:hover {
    background: rgba(255,255,255,0.1);
    color: var(--text-light);
}

.continue-watching-row {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding: 10px 0;
    scrollbar-width: none;
}

.continue-watching-row::-webkit-scrollbar {
    display: none;
}

.continue-card {
    flex: 0 0 300px;
    background: var(--background-card);
    border-radius: var(--radius);
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border: 3px solid transparent;
}

.continue-card:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

.continue-card.focused {
    border-color: var(--primary-color);
    transform: scale(1.08);
    box-shadow: var(--focus-shadow);
}

.continue-thumbnail {
    position: relative;
    height: 170px;
    background: linear-gradient(135deg, #333, #1a1a1a);
    overflow: hidden;
}

.continue-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.continue-play-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.continue-card:hover .continue-play-overlay {
    opacity: 1;
}

.continue-play-btn {
    width: 60px;
    height: 60px;
    background: rgba(229, 9, 20, 0.95);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}

.continue-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: rgba(255,255,255,0.2);
}

.continue-progress-bar {
    height: 100%;
    background: var(--primary-color);
    transition: width 0.3s ease;
}

.continue-info {
    padding: 14px;
}

.continue-series-title {
    font-size: 0.85rem;
    color: var(--muted);
    margin-bottom: 3px;
}

.continue-episode-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-light);
    margin-bottom: 6px;
}

.continue-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    color: var(--muted);
}

.continue-remove {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    background: rgba(0,0,0,0.7);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    opacity: 0;
    transition: all 0.2s ease;
    cursor: pointer;
    font-size: 1rem;
}

.continue-card:hover .continue-remove {
    opacity: 1;
}

.continue-remove:hover {
    background: var(--primary-color);
    transform: scale(1.1);
}

/* MAIN GRID - INCREASED POSTERS PER ROW */
.main-content {
    padding-top: 5px;
}

.all-series-header {
    padding: 15px 30px 10px;
    font-size: 1.4rem;
    font-weight: 600;
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 12px;
    padding: 0 30px 30px;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.card {
    background: transparent;
    border-radius: 6px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border: 2px solid transparent;
    outline: none;
}

.card img { 
    width: 100%; 
    height: 210px; 
    object-fit: cover;
    transition: transform 0.3s ease;
}

.card-title { 
    padding: 10px; 
    font-size: 0.85rem; 
    font-weight: 500;
    background: linear-gradient(180deg, transparent, rgba(0,0,0,0.9));
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    color: white;
}

.card.focused {
    border-color: var(--primary-color);
    transform: scale(1.1);
    box-shadow: var(--focus-shadow);
    z-index: 5;
}

.card.focused img {
    transform: scale(1.05);
}

/* BADGES */
.badge {
    position: absolute;
    top: 6px;
    left: 6px;
    background: var(--primary-color);
    padding: 4px 10px;
    font-size: 0.7rem;
    border-radius: 4px;
    font-weight: bold;
    z-index: 2;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.badge.doblado { 
    background: #46d369; 
}

.badge.estreno { 
    background: #ff6b35;
    animation: glow 2s ease-in-out infinite;
}

@keyframes glow {
    0%, 100% { box-shadow: 0 0 5px currentColor; }
    50% { box-shadow: 0 0 20px currentColor; }
}

/* SERIES OVERLAY */
.series-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--background-dark);
    z-index: 100;
    overflow-y: auto;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}

/* SERIES BANNER - OPTIMIZED SIZE */
.series-banner {
    position: relative;
    width: 100%;
    height: 250px;
    overflow: hidden;
    background: linear-gradient(135deg, #1a1a1a, #0a0a0a);
}

/* TV Responsive Banner Sizes */
@media screen and (min-width: 1920px) {
    .series-banner {
        height: 280px;
    }
}

@media screen and (min-width: 2560px) {
    .series-banner {
        height: 320px;
    }
}

@media screen and (min-width: 3840px) {
    .series-banner {
        height: 380px;
    }
}

.series-banner-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center 25%;
    filter: brightness(0.6);
    transform: scale(1.1);
}

.series-banner-gradient {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 80%;
    background: linear-gradient(to top, var(--background-dark) 0%, rgba(20,20,20,0.8) 30%, transparent 100%);
    pointer-events: none;
}

.series-banner-info {
    position: absolute;
    bottom: 25px;
    left: 30px;
    right: 30px;
    z-index: 2;
}

.series-banner-title {
    font-size: 2.2rem;
    font-weight: 700;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.9);
    margin-bottom: 10px;
    animation: fadeInUp 0.6s ease-out;
    letter-spacing: 0.5px;
}

/* TV Font Sizes */
@media screen and (min-width: 1920px) {
    .series-banner-title {
        font-size: 2.5rem;
    }
}

@media screen and (min-width: 3840px) {
    .series-banner-title {
        font-size: 3rem;
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.series-banner-meta {
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 0.95rem;
    color: rgba(255,255,255,0.8);
    animation: fadeInUp 0.8s ease-out;
}

.series-banner-badge {
    display: inline-block;
    padding: 4px 12px;
    background: var(--primary-color);
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: bold;
}

.series-banner-play {
    position: absolute;
    bottom: 25px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: rgba(229, 9, 20, 0.95);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(0,0,0,0.5);
    animation: pulse 2s infinite;
}

/* TV Play Button Size */
@media screen and (min-width: 1920px) {
    .series-banner-play {
        width: 70px;
        height: 70px;
        font-size: 1.8rem;
    }
}

@media screen and (min-width: 3840px) {
    .series-banner-play {
        width: 80px;
        height: 80px;
        font-size: 2rem;
    }
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.series-banner-play:hover {
    background: var(--primary-color);
    transform: scale(1.1);
    box-shadow: 0 8px 30px rgba(229, 9, 20, 0.5);
}

/* Season Bar with Banner */
.season-bar {
    display: flex;
    gap: 15px;
    padding: 15px 30px 20px;
    overflow-x: auto;
    scrollbar-width: none;
    background: linear-gradient(to bottom, rgba(20,20,20,0.3), transparent);
    margin-top: -10px;
    position: relative;
    z-index: 3;
}

.season-bar::-webkit-scrollbar {
    display: none;
}

.season {
    background: rgba(24, 24, 24, 0.85);
    border-radius: var(--radius);
    padding: 10px 20px;
    color: var(--muted);
    border: 2px solid transparent;
    transition: all var(--transition);
    cursor: pointer;
    font-weight: 500;
    font-size: 0.95rem;
    white-space: nowrap;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    outline: none;
    position: relative;
    backdrop-filter: blur(10px);
}

.season::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 3px;
    background: var(--primary-color);
    transition: all 0.3s ease;
    transform: translateX(-50%);
}

.season.focused {
    border-color: var(--primary-color);
    color: var(--text-light);
    transform: scale(1.08);
    background: rgba(24, 24, 24, 0.95);
    box-shadow: 0 8px 16px rgba(0,0,0,0.5);
}

.season.active {
    background: var(--primary-color);
    color: #fff;
    box-shadow: 0 6px 12px rgba(229, 9, 20, 0.4);
}

.season.active::after {
    width: 100%;
}

/* Episodes - REDUCED SIZE */
.episodes-container {
    background: var(--background-dark);
    padding-top: 15px;
    min-height: 300px;
}

.episodes-row {
    position: relative;
    overflow: hidden;
}

.episodes-track {
    display: flex;
    gap: 15px;
    padding: 0 30px 30px;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.episode {
    flex: 0 0 280px;
    background: var(--background-card);
    border-radius: 6px;
    border: 2px solid transparent;
    transition: all var(--transition);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    cursor: pointer;
    outline: none;
    position: relative;
}

/* TV Episode Card Size */
@media screen and (min-width: 1920px) {
    .episode {
        flex: 0 0 320px;
    }
}

@media screen and (min-width: 3840px) {
    .episode {
        flex: 0 0 380px;
    }
}

.episode::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary-color), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.episode.focused::before {
    opacity: 1;
}

.thumb {
    background: linear-gradient(135deg, #333, #1a1a1a);
    height: 160px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--muted);
    font-size: 0.9rem;
    position: relative;
    overflow: hidden;
}

.thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.ep-number {
    position: absolute;
    top: 8px;
    left: 8px;
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
}

.episode.focused {
    border-color: var(--primary-color);
    transform: scale(1.08) translateY(-5px);
    box-shadow: var(--focus-shadow);
    z-index: 5;
}

.episode.bloqueado {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(1);
}

.episode.bloqueado::after {
    content: "üîí";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    z-index: 10;
}

.ep-info {
    padding: 12px;
    background: linear-gradient(180deg, var(--background-card), rgba(0,0,0,0.5));
}

.ep-title {
    font-size: 0.95rem;
    font-weight: 600;
    line-height: 1.3;
}

.play-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50px;
    height: 50px;
    background: rgba(229, 9, 20, 0.95);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}

.episode.focused .play-icon {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

.episode:hover .play-icon {
    opacity: 0.9;
}

.play-icon::after {
    content: "‚ñ∂";
    color: white;
    font-size: 1.2rem;
    margin-left: 3px;
}

/* Navigation Help */
.nav-help {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 0.9rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 200;
}

.nav-help.show {
    opacity: 1;
}

/* BACK BUTTON */
.back-button {
    position: fixed;
    top: 25px;
    left: 25px;
    background: rgba(34, 34, 34, 0.95);
    color: var(--text-light);
    border: 2px solid transparent;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    display: none;
    z-index: 201;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.back-button:hover,
.back-button:focus {
    background: var(--primary-color);
    border-color: var(--primary-color);
    transform: scale(1.05);
}

.back-button.visible {
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideInLeft 0.3s ease-out;
}

@keyframes slideInLeft {
    from { transform: translateX(-100%); }
    to { transform: translateX(0); }
}

.close {
    position: fixed;
    top: 25px;
    right: 25px;
    font-size: 2.5rem;
    cursor: pointer;
    color: white;
    z-index: 201;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.6);
    border-radius: 50%;
    transition: all 0.3s ease;
}

.close:hover {
    background: var(--primary-color);
    transform: rotate(90deg);
}

/* Error message */
.error-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(229, 9, 20, 0.95);
    color: white;
    padding: 20px 30px;
    border-radius: 10px;
    z-index: 1000;
    display: none;
    animation: shake 0.5s ease-in-out;
    font-size: 1rem;
}

@keyframes shake {
    0%, 100% { transform: translate(-50%, -50%) rotate(0); }
    25% { transform: translate(-52%, -50%) rotate(-2deg); }
    75% { transform: translate(-48%, -50%) rotate(2deg); }
}

.error-message.show {
    display: block;
}

/* TV Responsive Adjustments - MORE POSTERS PER ROW */
@media screen and (min-width: 1280px) and (max-width: 1919px) {
    /* HD Ready TV - 8 posters per row */
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 14px;
    }
    
    .card img {
        height: 225px;
    }
    
    .episode {
        flex: 0 0 300px;
    }
    
    .series-banner {
        height: 240px;
    }
}

@media screen and (min-width: 1920px) and (max-width: 2559px) {
    /* Full HD TV - 10 posters per row */
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
        gap: 16px;
        padding: 0 40px 40px;
    }
    
    .card img {
        height: 255px;
    }
    
    .card-title {
        font-size: 0.9rem;
        padding: 11px;
    }
    
    .episode {
        flex: 0 0 320px;
    }
    
    .thumb {
        height: 170px;
    }
}

@media screen and (min-width: 2560px) and (max-width: 3839px) {
    /* 2K/QHD TV - 12 posters per row */
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
        gap: 18px;
        padding: 0 50px 50px;
    }
    
    .card img {
        height: 285px;
    }
    
    .card-title {
        font-size: 0.95rem;
        padding: 12px;
    }
    
    .episode {
        flex: 0 0 350px;
    }
    
    .thumb {
        height: 180px;
    }
}

@media screen and (min-width: 3840px) {
    /* 4K TV - 15 posters per row */
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 20px;
        padding: 0 60px 60px;
    }
    
    .card img {
        height: 330px;
    }
    
    .card-title {
        font-size: 1rem;
        padding: 14px;
    }
    
    .episode {
        flex: 0 0 380px;
    }
    
    .thumb {
        height: 190px;
    }
    
    header {
        padding: 20px 50px;
        min-height: 80px;
    }
    
    .logo {
        font-size: 2.2rem;
    }
}

/* Mobile/Tablet Responsive */
@media (max-width: 768px) {
    header, .grid, .season-bar, .episodes-track, .continue-watching-section {
        padding-left: 15px;
        padding-right: 15px;
    }
    
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 8px;
    }
    
    .card img {
        height: 150px;
    }
    
    .card-title {
        font-size: 0.75rem;
        padding: 6px;
    }
    
    .series-banner {
        height: 200px;
    }
    
    .series-banner-title {
        font-size: 1.6rem;
    }
    
    .series-banner-info {
        left: 15px;
        right: 15px;
        bottom: 15px;
    }
    
    .series-banner-play {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
        right: 15px;
        bottom: 15px;
    }
    
    .logo {
        font-size: 1.3rem;
        margin-right: 10px;
    }
    
    .search-container {
        max-width: 100%;
    }
    
    .episode {
        flex: 0 0 240px;
    }
    
    .thumb {
        height: 135px;
    }
    
    .continue-card {
        flex: 0 0 260px;
    }
    
    .continue-thumbnail {
        height: 145px;
    }
    
    .card.focused {
        transform: scale(1.06);
    }
}

@media (max-width: 480px) {
    .grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 6px;
    }
    
    .card img {
        height: 120px;
    }
    
    .badge {
        font-size: 0.6rem;
        padding: 2px 6px;
    }
}

/* Accessibility */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* TV Focus States Enhancement */
@media screen and (min-width: 1280px) {
    .card.focused,
    .continue-card.focused,
    .episode.focused {
        box-shadow: 0 0 0 3px var(--primary-color), var(--focus-shadow);
    }
    
    .season.focused {
        box-shadow: 0 0 0 2px var(--primary-color);
    }
}
</style>
</head>
<body>

<div class="loader" id="loader"></div>

<header>
    <div class="logo">SERIES+</div>
    
    <!-- Professional Search Bar -->
    <div class="search-container">
        <div class="search-wrapper">
            <input type="text" class="search-box" id="searchBox" placeholder="Buscar...">
            <div class="search-clear" id="searchClear">√ó</div>
            <div class="search-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
            </div>
            <div class="search-results" id="searchResults"></div>
        </div>
    </div>
</header>

<button class="back-button" id="backButton">
    <span>‚Üê</span>
    <span>Back</span>
</button>

<!-- Continue Watching Section -->
<section class="continue-watching-section" id="continueWatchingSection">
    <div class="section-header">
        <span>Continue Watching...</span>
        <span class="clear-continue" id="clearContinue">Limpiar todo</span>
    </div>
    <div class="continue-watching-row" id="continueWatchingRow">
        <!-- Continue watching cards will be added dynamically -->
    </div>
</section>

<!-- Main Content -->
<div class="main-content">
    <div class="all-series-header"> All Series</div>
    <section class="grid" id="mainGrid">
        <!-- Las tarjetas se cargar√°n din√°micamente -->
    </section>
</div>

<!-- SERIES OVERLAY -->
<div id="seriesOverlay" class="series-overlay">
    <span class="close" id="closeButton">√ó</span>
    
    <!-- Series Banner -->
    <div class="series-banner" id="seriesBanner">
        <img class="series-banner-image" id="seriesBannerImage" src="" alt="">
        <div class="series-banner-gradient"></div>
        <div class="series-banner-info">
            <h1 class="series-banner-title" id="seriesBannerTitle"></h1>
            <div class="series-banner-meta" id="seriesBannerMeta"></div>
        </div>
        <div class="series-banner-play" id="seriesBannerPlay">‚ñ∂</div>
    </div>
    
    <div class="season-bar" id="seasonBar"></div>
    
    <div class="episodes-container">
        <div class="episodes-row">
            <div class="episodes-track" id="episodesTrack"></div>
        </div>
    </div>
</div>

<!-- Navigation Help -->
<div class="nav-help" id="navHelp">
    Presiona ‚Üë para ir a la b√∫squeda
</div>

<!-- Error message -->
<div class="error-message" id="errorMessage">
    Error cargando el contenido
</div>

<script>
/* ========================================
   STREAMING PLATFORM WITH ENHANCED NAVIGATION
   ======================================== */

class StreamingPlatform {
    constructor() {
        this.seriesData = {};
        this.cards = [];
        this.continueWatchingData = [];
        this.index = 0;
        this.currentSeries = null;
        this.currentSeriesId = null;
        this.currentSeason = 0;
        this.focusMode = "grid"; // Puede ser: "search", "grid", "season", "episode", "continue"
        this.seasonFocus = 0;
        this.episodeFocus = 0;
        this.continueFocus = 0;
        this.scrollX = 0;
        this.searchTimeout = null;
        this.searchResultIndex = 0;
        this.dataUrl = 'series-data.json';
        this.refreshInterval = null;
        this.navHelpTimeout = null;
        
        this.initializeElements();
        this.loadContinueWatching();
        this.loadData();
    }
    
    initializeElements() {
        // Cache DOM elements
        this.loader = document.getElementById('loader');
        this.mainGrid = document.getElementById('mainGrid');
        this.seriesOverlay = document.getElementById('seriesOverlay');
        this.backButton = document.getElementById('backButton');
        this.closeButton = document.getElementById('closeButton');
        this.seasonBar = document.getElementById('seasonBar');
        this.episodesTrack = document.getElementById('episodesTrack');
        this.errorMessage = document.getElementById('errorMessage');
        this.searchBox = document.getElementById('searchBox');
        this.searchResults = document.getElementById('searchResults');
        this.searchClear = document.getElementById('searchClear');
        this.navHelp = document.getElementById('navHelp');
        this.continueWatchingSection = document.getElementById('continueWatchingSection');
        this.continueWatchingRow = document.getElementById('continueWatchingRow');
        this.clearContinue = document.getElementById('clearContinue');
        this.seriesBanner = document.getElementById('seriesBanner');
        this.seriesBannerImage = document.getElementById('seriesBannerImage');
        this.seriesBannerTitle = document.getElementById('seriesBannerTitle');
        this.seriesBannerMeta = document.getElementById('seriesBannerMeta');
        this.seriesBannerPlay = document.getElementById('seriesBannerPlay');
        
        // Event listeners
        this.backButton.addEventListener('click', () => this.closeModal());
        this.closeButton.addEventListener('click', () => this.closeModal());
        document.addEventListener('keydown', (e) => this.handleKeyboard(e));
        
        // Banner play button
        this.seriesBannerPlay.addEventListener('click', () => {
            this.playFirstAvailableEpisode();
        });
        
        // Clear continue watching
        this.clearContinue.addEventListener('click', () => {
            this.clearContinueWatching();
        });
        
        // Search events
        this.searchBox.addEventListener('input', (e) => this.handleSearch(e));
        this.searchBox.addEventListener('focus', () => {
            this.focusMode = 'search';
            this.searchBox.classList.add('focused');
            this.showSearchResults();
        });
        
        this.searchBox.addEventListener('blur', () => {
            setTimeout(() => {
                if (this.focusMode === 'search' && !this.searchResults.contains(document.activeElement)) {
                    this.hideSearchResults();
                    this.searchBox.classList.remove('focused');
                    this.focusMode = this.continueWatchingData.length > 0 ? 'continue' : 'grid';
                    if (this.focusMode === 'continue') {
                        this.continueFocus = 0;
                        this.updateContinueFocus();
                    } else {
                        this.focusCard();
                    }
                }
            }, 200);
        });
        
        // Clear button
        this.searchClear.addEventListener('click', () => {
            this.searchBox.value = '';
            this.searchClear.classList.remove('visible');
            this.hideSearchResults();
            this.searchBox.focus();
        });
        
        // Auto-refresh cada 5 minutos
        this.refreshInterval = setInterval(() => this.refreshData(), 300000);
    }
    
    createBannerFromPoster(posterUrl) {
        // Transformar la URL del poster para usarla como banner
        // El poster se estira y se ajusta para verse como banner
        return posterUrl;
    }
    
    updateSeriesBanner(serie) {
        // Usar el poster como imagen de banner
        const bannerImage = this.createBannerFromPoster(serie.poster || 'https://via.placeholder.com/1920x400');
        this.seriesBannerImage.src = bannerImage;
        this.seriesBannerImage.alt = serie.displayTitle || serie.title;
        this.seriesBannerImage.onerror = () => {
            this.seriesBannerImage.src = 'https://via.placeholder.com/1920x400?text=' + encodeURIComponent(serie.displayTitle || serie.title);
        };
        
        // Actualizar t√≠tulo
        this.seriesBannerTitle.textContent = serie.displayTitle || serie.title;
        
        // Actualizar metadata
        this.seriesBannerMeta.innerHTML = '';
        
        if (serie.badge) {
            const badge = document.createElement('span');
            badge.className = 'series-banner-badge';
            badge.textContent = serie.badge;
            if (serie.badgeType === 'doblado') {
                badge.style.background = '#46d369';
            } else if (serie.badgeType === 'estreno') {
                badge.style.background = '#ff6b35';
            }
            this.seriesBannerMeta.appendChild(badge);
        }
        
        // Contar temporadas y episodios
        const seasonCount = serie.seasons ? Object.keys(serie.seasons).length : 0;
        let episodeCount = 0;
        if (serie.seasons) {
            Object.values(serie.seasons).forEach(episodes => {
                episodeCount += episodes ? episodes.length : 0;
            });
        }
        
        if (seasonCount > 0) {
            const info = document.createElement('span');
            info.textContent = `${seasonCount} Temporada${seasonCount > 1 ? 's' : ''} ‚Ä¢ ${episodeCount} Episodio${episodeCount > 1 ? 's' : ''}`;
            this.seriesBannerMeta.appendChild(info);
        }
    }
    
    playFirstAvailableEpisode() {
        if (!this.currentSeries || !this.currentSeries.seasons) return;
        
        const seasonKeys = Object.keys(this.currentSeries.seasons);
        for (let seasonIndex = 0; seasonIndex < seasonKeys.length; seasonIndex++) {
            const episodes = this.currentSeries.seasons[seasonKeys[seasonIndex]];
            if (episodes && episodes.length > 0) {
                for (let epIndex = 0; epIndex < episodes.length; epIndex++) {
                    const ep = episodes[epIndex];
                    if (!ep.locked && ep.url) {
                        // Guardar en seguir viendo
                        this.saveContinueWatching(
                            this.currentSeriesId,
                            this.currentSeries.displayTitle || this.currentSeries.title,
                            seasonIndex,
                            epIndex,
                            ep.title,
                            0,
                            ep.thumbnail
                        );
                        
                        this.playEpisode(ep.url);
                        return;
                    }
                }
            }
        }
        
        this.showError('No hay episodios disponibles para reproducir');
    }
    
    loadContinueWatching() {
        // Cargar datos de localStorage
        const savedData = localStorage.getItem('continueWatching');
        if (savedData) {
            try {
                this.continueWatchingData = JSON.parse(savedData);
                this.renderContinueWatching();
            } catch (e) {
                this.continueWatchingData = [];
            }
        }
    }
    
    saveContinueWatching(seriesId, seriesTitle, seasonIndex, episodeIndex, episodeTitle, progress = 0, thumbnail = null) {
        // Buscar si ya existe
        const existingIndex = this.continueWatchingData.findIndex(item => 
            item.seriesId === seriesId && 
            item.seasonIndex === seasonIndex && 
            item.episodeIndex === episodeIndex
        );
        
        const continueItem = {
            seriesId,
            seriesTitle,
            seasonIndex,
            episodeIndex,
            episodeTitle,
            progress: progress || Math.random() * 100, // Simular progreso aleatorio
            thumbnail,
            timestamp: new Date().toISOString()
        };
        
        if (existingIndex !== -1) {
            // Actualizar existente
            this.continueWatchingData[existingIndex] = continueItem;
        } else {
            // Agregar nuevo al principio
            this.continueWatchingData.unshift(continueItem);
            // Limitar a 10 items m√°ximo
            if (this.continueWatchingData.length > 10) {
                this.continueWatchingData = this.continueWatchingData.slice(0, 10);
            }
        }
        
        localStorage.setItem('continueWatching', JSON.stringify(this.continueWatchingData));
        this.renderContinueWatching();
    }
    
    renderContinueWatching() {
        if (this.continueWatchingData.length === 0) {
            this.continueWatchingSection.classList.remove('active');
            return;
        }
        
        this.continueWatchingSection.classList.add('active');
        this.continueWatchingRow.innerHTML = '';
        
        this.continueWatchingData.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'continue-card';
            card.dataset.index = index;
            
            const thumbnail = document.createElement('div');
            thumbnail.className = 'continue-thumbnail';
            
            if (item.thumbnail) {
                const img = document.createElement('img');
                img.src = item.thumbnail;
                img.alt = item.episodeTitle;
                img.onerror = () => { img.style.display = 'none'; };
                thumbnail.appendChild(img);
            }
            
            const playOverlay = document.createElement('div');
            playOverlay.className = 'continue-play-overlay';
            playOverlay.innerHTML = '<div class="continue-play-btn">‚ñ∂</div>';
            thumbnail.appendChild(playOverlay);
            
            const progress = document.createElement('div');
            progress.className = 'continue-progress';
            const progressBar = document.createElement('div');
            progressBar.className = 'continue-progress-bar';
            progressBar.style.width = `${item.progress}%`;
            progress.appendChild(progressBar);
            thumbnail.appendChild(progress);
            
            card.appendChild(thumbnail);
            
            const info = document.createElement('div');
            info.className = 'continue-info';
            
            const seriesTitle = document.createElement('div');
            seriesTitle.className = 'continue-series-title';
            seriesTitle.textContent = item.seriesTitle;
            info.appendChild(seriesTitle);
            
            const episodeTitle = document.createElement('div');
            episodeTitle.className = 'continue-episode-title';
            episodeTitle.textContent = item.episodeTitle;
            info.appendChild(episodeTitle);
            
            const meta = document.createElement('div');
            meta.className = 'continue-meta';
            meta.innerHTML = `
                <span>T${item.seasonIndex + 1}:E${item.episodeIndex + 1}</span>
                <span>‚Ä¢</span>
                <span>${Math.round(item.progress)}% visto</span>
            `;
            info.appendChild(meta);
            
            card.appendChild(info);
            
            const removeBtn = document.createElement('div');
            removeBtn.className = 'continue-remove';
            removeBtn.innerHTML = '√ó';
            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                this.removeContinueItem(index);
            });
            card.appendChild(removeBtn);
            
            card.addEventListener('click', () => {
                this.resumeWatching(item);
            });
            
            this.continueWatchingRow.appendChild(card);
        });
    }
    
    removeContinueItem(index) {
        this.continueWatchingData.splice(index, 1);
        localStorage.setItem('continueWatching', JSON.stringify(this.continueWatchingData));
        this.renderContinueWatching();
    }
    
    clearContinueWatching() {
        if (confirm('¬øEliminar todo el historial de "Seguir viendo"?')) {
            this.continueWatchingData = [];
            localStorage.removeItem('continueWatching');
            this.renderContinueWatching();
            this.focusMode = 'grid';
            this.index = 0;
            this.focusCard();
        }
    }
    
    resumeWatching(item) {
        // Abrir la serie en el episodio correspondiente
        this.openSeriesDetail(item.seriesId);
        setTimeout(() => {
            this.currentSeason = item.seasonIndex;
            this.episodeFocus = item.episodeIndex;
            this.renderSeasons();
            this.renderEpisodes();
            
            // Simular clic en el episodio
            const episodes = this.currentSeries.seasons[Object.keys(this.currentSeries.seasons)[item.seasonIndex]];
            if (episodes && episodes[item.episodeIndex]) {
                const ep = episodes[item.episodeIndex];
                if (ep.url) {
                    this.playEpisode(ep.url);
                }
            }
        }, 100);
    }
    
    updateContinueFocus() {
        const cards = this.continueWatchingRow.querySelectorAll('.continue-card');
        cards.forEach((card, index) => {
            card.classList.toggle('focused', index === this.continueFocus);
            if (index === this.continueFocus) {
                card.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest',
                    inline: 'center'
                });
            }
        });
    }
    
    async loadData() {
        try {
            this.showLoader(true);
            
            // Cargar desde el archivo JSON
            const response = await fetch(this.dataUrl);
            if (!response.ok) throw new Error('Error loading data');
            
            const data = await response.json();
            this.processSeriesData(data);
            this.renderGrid();
            
        } catch (error) {
            console.error('Error loading series data:', error);
            this.showError('Error cargando las series. Usando datos de respaldo.');
            this.loadFallbackData();
        } finally {
            this.showLoader(false);
        }
    }
    
    processSeriesData(data) {
        this.seriesData = {};
        
        // Procesar el formato del JSON original
        if (data.series && Array.isArray(data.series)) {
            data.series.forEach(serie => {
                this.seriesData[serie.id] = {
                    title: serie.title,
                    displayTitle: serie.displayTitle || serie.title,
                    poster: serie.poster,
                    badge: serie.badge,
                    badgeType: serie.badgeType,
                    seasons: serie.seasons || {}
                };
            });
        }
    }
    
    loadFallbackData() {
        // Datos de respaldo en caso de error
        this.seriesData = {
            "fallback-series": {
                title: "SERIE DE EJEMPLO",
                displayTitle: "Serie de Ejemplo",
                poster: "https://via.placeholder.com/300x450?text=Sin+Imagen",
                badge: "DEMO",
                badgeType: "",
                seasons: {
                    "Temporada 1": [
                        { 
                            title: "Episodio 1", 
                            url: "#",
                            thumbnail: "https://via.placeholder.com/320x180?text=Episodio+1"
                        }
                    ]
                }
            }
        };
        this.renderGrid();
    }
    
    renderGrid() {
        this.mainGrid.innerHTML = '';
        this.cards = [];
        
        Object.entries(this.seriesData).forEach(([id, serie], index) => {
            const card = this.createCard(id, serie);
            this.mainGrid.appendChild(card);
            this.cards.push(card);
            
            // Animation delay
            card.style.animationDelay = `${index * 0.03}s`;
        });
        
        if (this.cards.length > 0) {
            this.index = 0;
            if (this.focusMode === 'grid') {
                this.focusCard();
            }
        }
    }
    
    createCard(id, serie) {
        const article = document.createElement('article');
        article.className = 'card';
        article.dataset.series = id;
        article.tabIndex = -1;
        
        // Badge
        if (serie.badge) {
            const badge = document.createElement('span');
            badge.className = `badge ${serie.badgeType || ''}`;
            badge.textContent = serie.badge;
            article.appendChild(badge);
        }
        
        // Image con poster correcto
        const img = document.createElement('img');
        img.src = serie.poster || 'https://via.placeholder.com/300x450?text=No+Image';
        img.alt = serie.displayTitle || serie.title;
        img.loading = 'lazy';
        img.onerror = () => { 
            img.src = 'https://via.placeholder.com/300x450?text=' + encodeURIComponent(serie.displayTitle || serie.title); 
        };
        article.appendChild(img);
        
        // Title
        const titleDiv = document.createElement('div');
        titleDiv.className = 'card-title';
        titleDiv.textContent = serie.displayTitle || serie.title;
        article.appendChild(titleDiv);
        
        // Click event
        article.addEventListener('click', () => this.openSeriesDetail(id));
        
        return article;
    }
    
    handleSearch(e) {
        const query = e.target.value.toLowerCase().trim();
        
        // Show/hide clear button
        if (query) {
            this.searchClear.classList.add('visible');
        } else {
            this.searchClear.classList.remove('visible');
        }
        
        clearTimeout(this.searchTimeout);
        
        if (!query) {
            this.hideSearchResults();
            return;
        }
        
        this.searchTimeout = setTimeout(() => {
            this.performSearch(query);
        }, 300);
    }
    
    performSearch(query) {
        const results = [];
        
        Object.entries(this.seriesData).forEach(([id, serie]) => {
            const title = (serie.displayTitle || serie.title || '').toLowerCase();
            const mainTitle = (serie.title || '').toLowerCase();
            
            if (title.includes(query) || mainTitle.includes(query)) {
                results.push({ id, ...serie });
            }
        });
        
        this.displaySearchResults(results, query);
    }
    
    displaySearchResults(results, query) {
        this.searchResults.innerHTML = '';
        this.searchResultIndex = 0;
        
        if (results.length === 0) {
            this.searchResults.innerHTML = `
                <div class="no-results">
                    No se encontraron resultados para "${query}"
                </div>
            `;
        } else {
            results.forEach((result, index) => {
                const item = document.createElement('div');
                item.className = 'search-result-item';
                item.dataset.resultIndex = index;
                item.dataset.seriesId = result.id;
                
                const poster = document.createElement('img');
                poster.src = result.poster || 'https://via.placeholder.com/40x60';
                poster.alt = result.displayTitle || result.title;
                poster.className = 'search-result-poster';
                poster.onerror = () => { poster.src = 'https://via.placeholder.com/40x60'; };
                
                const info = document.createElement('div');
                info.className = 'search-result-info';
                
                const title = document.createElement('div');
                title.className = 'search-result-title';
                title.textContent = result.displayTitle || result.title;
                
                info.appendChild(title);
                
                item.appendChild(poster);
                item.appendChild(info);
                
                item.addEventListener('click', () => {
                    this.openSeriesDetail(result.id);
                    this.hideSearchResults();
                    this.searchBox.value = '';
                    this.searchBox.classList.remove('focused');
                    this.searchClear.classList.remove('visible');
                });
                
                this.searchResults.appendChild(item);
            });
        }
        
        this.searchResults.classList.add('active');
        this.updateSearchResultFocus();
    }
    
    updateSearchResultFocus() {
        const results = this.searchResults.querySelectorAll('.search-result-item');
        results.forEach((item, index) => {
            item.classList.toggle('focused', index === this.searchResultIndex);
            if (index === this.searchResultIndex) {
                item.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest'
                });
            }
        });
    }
    
    showSearchResults() {
        if (this.searchBox.value.trim()) {
            this.performSearch(this.searchBox.value.toLowerCase().trim());
        }
    }
    
    hideSearchResults() {
        this.searchResults.classList.remove('active');
    }
    
    focusCard() {
        if (this.cards.length === 0) return;
        
        this.cards.forEach((c, i) => {
            c.classList.remove('focused');
            c.tabIndex = -1;
        });
        
        const currentCard = this.cards[this.index];
        if (currentCard) {
            currentCard.classList.add('focused');
            currentCard.tabIndex = 0;
            currentCard.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center', 
                inline: 'center' 
            });
        }
    }
    
    openSeriesDetail(seriesId) {
        this.currentSeries = this.seriesData[seriesId];
        this.currentSeriesId = seriesId;
        if (!this.currentSeries) return;
        
        this.mainGrid.parentElement.style.display = 'none';
        this.continueWatchingSection.style.display = 'none';
        this.seriesOverlay.style.display = 'block';
        this.backButton.classList.add('visible');
        
        // Actualizar el banner
        this.updateSeriesBanner(this.currentSeries);
        
        // Reset navigation
        this.currentSeason = 0;
        this.focusMode = 'season';
        this.seasonFocus = 0;
        this.episodeFocus = 0;
        
        this.renderSeasons();
        this.renderEpisodes();
        
        // Push state for browser back button
        history.pushState({ modal: true }, '', '#' + seriesId);
    }
    
    renderSeasons() {
        this.seasonBar.innerHTML = '';
        
        if (!this.currentSeries.seasons || Object.keys(this.currentSeries.seasons).length === 0) {
            // Si no hay temporadas, mostrar mensaje
            const noSeasons = document.createElement('div');
            noSeasons.className = 'season active';
            noSeasons.textContent = 'Sin temporadas disponibles';
            this.seasonBar.appendChild(noSeasons);
            return;
        }
        
        const seasonKeys = Object.keys(this.currentSeries.seasons);
        
        seasonKeys.forEach((seasonName, i) => {
            const seasonDiv = document.createElement('div');
            seasonDiv.className = 'season';
            seasonDiv.tabIndex = -1;
            
            if (i === this.currentSeason) {
                seasonDiv.classList.add('active');
            }
            
            seasonDiv.textContent = seasonName;
            seasonDiv.dataset.index = i;
            
            seasonDiv.addEventListener('click', () => {
                this.currentSeason = i;
                this.episodeFocus = 0;
                this.renderSeasons();
                this.renderEpisodes();
            });
            
            this.seasonBar.appendChild(seasonDiv);
        });
        
        this.updateSeriesFocus();
    }
    
    renderEpisodes() {
        this.episodesTrack.innerHTML = '';
        
        if (!this.currentSeries.seasons || Object.keys(this.currentSeries.seasons).length === 0) {
            // Si no hay temporadas/episodios
            const noEpisodes = document.createElement('div');
            noEpisodes.style.padding = '30px';
            noEpisodes.style.color = 'var(--muted)';
            noEpisodes.textContent = 'No hay episodios disponibles';
            this.episodesTrack.appendChild(noEpisodes);
            return;
        }
        
        const seasonKeys = Object.keys(this.currentSeries.seasons);
        const episodes = this.currentSeries.seasons[seasonKeys[this.currentSeason]];
        
        if (!episodes || episodes.length === 0) {
            const noEpisodes = document.createElement('div');
            noEpisodes.style.padding = '30px';
            noEpisodes.style.color = 'var(--muted)';
            noEpisodes.textContent = 'No hay episodios en esta temporada';
            this.episodesTrack.appendChild(noEpisodes);
            return;
        }
        
        episodes.forEach((ep, i) => {
            const episodeDiv = document.createElement('div');
            episodeDiv.className = 'episode';
            episodeDiv.tabIndex = -1;
            
            if (ep.locked) {
                episodeDiv.classList.add('bloqueado');
            }
            
            const thumb = document.createElement('div');
            thumb.className = 'thumb';
            
            const epNumber = document.createElement('div');
            epNumber.className = 'ep-number';
            epNumber.textContent = `${i + 1}`;
            thumb.appendChild(epNumber);
            
            // Usar thumbnail si est√° disponible
            if (ep.thumbnail) {
                const img = document.createElement('img');
                img.src = ep.thumbnail;
                img.alt = ep.title;
                img.onerror = () => {
                    img.style.display = 'none';
                    const placeholder = document.createElement('span');
                    placeholder.textContent = ep.title;
                    thumb.appendChild(placeholder);
                };
                thumb.appendChild(img);
            } else {
                const placeholder = document.createElement('span');
                placeholder.textContent = ep.title;
                thumb.appendChild(placeholder);
            }
            
            const playIcon = document.createElement('div');
            playIcon.className = 'play-icon';
            thumb.appendChild(playIcon);
            
            episodeDiv.appendChild(thumb);
            
            const epInfo = document.createElement('div');
            epInfo.className = 'ep-info';
            
            const epTitle = document.createElement('div');
            epTitle.className = 'ep-title';
            epTitle.textContent = ep.title;
            epInfo.appendChild(epTitle);
            
            episodeDiv.appendChild(epInfo);
            
            episodeDiv.dataset.index = i;
            
            if (!ep.locked) {
                episodeDiv.addEventListener('click', () => {
                    if (ep.url) {
                        // Guardar en seguir viendo
                        this.saveContinueWatching(
                            this.currentSeriesId,
                            this.currentSeries.displayTitle || this.currentSeries.title,
                            this.currentSeason,
                            i,
                            ep.title,
                            0,
                            ep.thumbnail
                        );
                        
                        this.playEpisode(ep.url);
                    }
                });
            }
            
            this.episodesTrack.appendChild(episodeDiv);
        });
        
        // Reset scroll
        this.scrollX = 0;
        this.episodesTrack.style.transform = 'translateX(0)';
        
        this.updateSeriesFocus();
    }
    
    updateSeriesFocus() {
        // Update seasons focus
        const seasons = this.seasonBar.querySelectorAll('.season');
        seasons.forEach((el, i) => {
            el.classList.toggle('focused', this.focusMode === 'season' && i === this.seasonFocus);
            el.tabIndex = (this.focusMode === 'season' && i === this.seasonFocus) ? 0 : -1;
        });
        
        // Update episodes focus
        const episodes = this.episodesTrack.querySelectorAll('.episode');
        episodes.forEach((el, i) => {
            el.classList.toggle('focused', this.focusMode === 'episode' && i === this.episodeFocus);
            el.tabIndex = (this.focusMode === 'episode' && i === this.episodeFocus) ? 0 : -1;
        });
        
        // Scroll to focused element
        if (this.focusMode === 'season' && seasons[this.seasonFocus]) {
            seasons[this.seasonFocus].scrollIntoView({ 
                behavior: 'smooth', 
                block: 'nearest', 
                inline: 'center' 
            });
        }
        
        this.updateSeriesScroll();
    }
    
    updateSeriesScroll() {
        if (this.focusMode === 'episode') {
            const episodeWidth = 295; // Adjusted for smaller episodes
            const containerWidth = window.innerWidth;
            const episodes = this.episodesTrack.querySelectorAll('.episode');
            
            if (episodes[this.episodeFocus]) {
                const focusedEpisode = episodes[this.episodeFocus];
                const rect = focusedEpisode.getBoundingClientRect();
                const containerRect = this.episodesTrack.parentElement.getBoundingClientRect();
                
                if (rect.left < containerRect.left || rect.right > containerRect.right) {
                    this.scrollX = Math.max(0, 
                        (this.episodeFocus * episodeWidth) - (containerWidth / 2) + (episodeWidth / 2)
                    );
                    
                    const totalWidth = episodes.length * episodeWidth;
                    const maxScroll = Math.max(0, totalWidth - containerWidth + 60);
                    this.scrollX = Math.min(this.scrollX, maxScroll);
                    
                    this.episodesTrack.style.transform = `translateX(${-this.scrollX}px)`;
                }
            }
        }
    }
    
    playEpisode(url) {
        if (url && url !== '#') {
            // Guardar progreso antes de navegar
            this.saveProgress();
            
            // Simplemente abrir la URL directamente
            window.location.href = url;
        } else {
            this.showError('URL del episodio no disponible');
        }
    }
    
    saveProgress() {
        if (this.currentSeries) {
            const progress = {
                seriesId: this.currentSeriesId,
                season: this.currentSeason,
                episode: this.episodeFocus,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('lastWatched', JSON.stringify(progress));
        }
    }
    
    closeModal() {
        this.seriesOverlay.style.display = 'none';
        this.backButton.classList.remove('visible');
        this.mainGrid.parentElement.style.display = 'block';
        
        // Mostrar continue watching si hay datos
        if (this.continueWatchingData.length > 0) {
            this.continueWatchingSection.style.display = 'block';
        }
        
        // Find and focus the current series card
        if (this.currentSeriesId) {
            const cardIndex = this.cards.findIndex(
                card => card.dataset.series === this.currentSeriesId
            );
            if (cardIndex !== -1) {
                this.index = cardIndex;
                this.focusCard();
            }
        }
        
        this.focusMode = 'grid';
        this.currentSeriesId = null;
        
        // Clear hash
        history.replaceState(null, '', ' ');
    }
    
    showNavHelp(text) {
        clearTimeout(this.navHelpTimeout);
        this.navHelp.textContent = text;
        this.navHelp.classList.add('show');
        
        this.navHelpTimeout = setTimeout(() => {
            this.navHelp.classList.remove('show');
        }, 2000);
    }
    
    handleKeyboard(e) {
        // Continue watching navigation
        if (this.focusMode === 'continue') {
            const cards = this.continueWatchingRow.querySelectorAll('.continue-card');
            
            switch(e.key) {
                case 'ArrowRight':
                    e.preventDefault();
                    this.continueFocus = Math.min(this.continueFocus + 1, cards.length - 1);
                    this.updateContinueFocus();
                    break;
                    
                case 'ArrowLeft':
                    e.preventDefault();
                    this.continueFocus = Math.max(this.continueFocus - 1, 0);
                    this.updateContinueFocus();
                    break;
                    
                case 'ArrowDown':
                    e.preventDefault();
                    this.focusMode = 'grid';
                    this.index = 0;
                    this.focusCard();
                    break;
                    
                case 'ArrowUp':
                    e.preventDefault();
                    this.focusMode = 'search';
                    this.searchBox.focus();
                    this.searchBox.classList.add('focused');
                    break;
                    
                case 'Enter':
                    e.preventDefault();
                    if (cards[this.continueFocus]) {
                        cards[this.continueFocus].click();
                    }
                    break;
            }
            return;
        }
        
        // Casos especiales para la navegaci√≥n global
        if (e.key === 'ArrowUp' && this.focusMode === 'grid') {
            e.preventDefault();
            
            // Si hay continue watching, ir ah√≠ primero
            if (this.continueWatchingData.length > 0 && this.index < this.getGridWidth()) {
                this.focusMode = 'continue';
                this.continueFocus = 0;
                this.updateContinueFocus();
            } else if (this.index < this.getGridWidth()) {
                // Si no, ir a b√∫squeda
                this.focusMode = 'search';
                this.searchBox.focus();
                this.searchBox.classList.add('focused');
                this.showNavHelp('B√∫squeda activa');
            } else {
                // Navegar hacia arriba en el grid
                const gridWidth = this.getGridWidth();
                this.index = Math.max(this.index - gridWidth, 0);
                this.focusCard();
            }
            return;
        }
        
        if (e.key === 'ArrowDown' && this.focusMode === 'search' && !this.searchResults.classList.contains('active')) {
            // Desde la b√∫squeda sin resultados, volver al grid o continue watching
            e.preventDefault();
            this.hideSearchResults();
            this.searchBox.blur();
            this.searchBox.classList.remove('focused');
            
            if (this.continueWatchingData.length > 0) {
                this.focusMode = 'continue';
                this.continueFocus = 0;
                this.updateContinueFocus();
            } else {
                this.focusMode = 'grid';
                this.index = 0;
                this.focusCard();
            }
            return;
        }
        
        // NAVEGACI√ìN MEJORADA EN B√öSQUEDA
        if (this.focusMode === 'search' && this.searchResults.classList.contains('active')) {
            const results = this.searchResults.querySelectorAll('.search-result-item');
            
            switch(e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    if (results.length > 0) {
                        // Navegaci√≥n circular hacia abajo
                        this.searchResultIndex = (this.searchResultIndex + 1) % results.length;
                        this.updateSearchResultFocus();
                    }
                    break;
                    
                case 'ArrowUp':
                    e.preventDefault();
                    if (results.length > 0) {
                        // Navegaci√≥n circular hacia arriba
                        this.searchResultIndex = (this.searchResultIndex - 1 + results.length) % results.length;
                        this.updateSearchResultFocus();
                    }
                    break;
                    
                case 'ArrowRight':
                    e.preventDefault();
                    if (results.length > 0) {
                        // Salto r√°pido de 3 elementos hacia adelante
                        this.searchResultIndex = Math.min(this.searchResultIndex + 3, results.length - 1);
                        this.updateSearchResultFocus();
                    }
                    break;
                    
                case 'ArrowLeft':
                    e.preventDefault();
                    if (results.length > 0) {
                        // Salto r√°pido de 3 elementos hacia atr√°s
                        this.searchResultIndex = Math.max(this.searchResultIndex - 3, 0);
                        this.updateSearchResultFocus();
                    }
                    break;
                    
                case 'Enter':
                    e.preventDefault();
                    if (results[this.searchResultIndex]) {
                        const seriesId = results[this.searchResultIndex].dataset.seriesId;
                        this.openSeriesDetail(seriesId);
                        this.hideSearchResults();
                        this.searchBox.value = '';
                        this.searchBox.classList.remove('focused');
                        this.searchClear.classList.remove('visible');
                    }
                    break;
                    
                case 'Escape':
                    e.preventDefault();
                    this.hideSearchResults();
                    this.searchBox.blur();
                    this.searchBox.classList.remove('focused');
                    this.searchBox.value = '';
                    this.searchClear.classList.remove('visible');
                    this.focusMode = 'grid';
                    this.focusCard();
                    break;
                    
                case 'Home':
                    e.preventDefault();
                    if (results.length > 0) {
                        this.searchResultIndex = 0;
                        this.updateSearchResultFocus();
                    }
                    break;
                    
                case 'End':
                    e.preventDefault();
                    if (results.length > 0) {
                        this.searchResultIndex = results.length - 1;
                        this.updateSearchResultFocus();
                    }
                    break;
                    
                case 'PageDown':
                    e.preventDefault();
                    if (results.length > 0) {
                        // Salto de p√°gina (5 elementos)
                        this.searchResultIndex = Math.min(this.searchResultIndex + 5, results.length - 1);
                        this.updateSearchResultFocus();
                    }
                    break;
                    
                case 'PageUp':
                    e.preventDefault();
                    if (results.length > 0) {
                        // Salto de p√°gina (5 elementos)
                        this.searchResultIndex = Math.max(this.searchResultIndex - 5, 0);
                        this.updateSearchResultFocus();
                    }
                    break;
                    
                case 'Tab':
                    // Permitir Tab para salir de los resultados
                    if (e.shiftKey) {
                        // Tab hacia atr√°s: volver al input
                        e.preventDefault();
                        this.searchBox.focus();
                    }
                    break;
            }
            return;
        }
        
        // Prevent default solo para teclas de navegaci√≥n
        if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter', 'Escape', 'Backspace'].includes(e.key)) {
            if (this.focusMode !== 'search' || e.key === 'Escape') {
                e.preventDefault();
            }
        }
        
        // Delegaci√≥n seg√∫n el modo
        if (this.seriesOverlay.style.display === 'block') {
            this.handleSeriesNavigation(e);
        } else if (this.focusMode === 'grid') {
            this.handleGridNavigation(e);
        }
    }
    
    getGridWidth() {
        return Math.floor(this.mainGrid.offsetWidth / (this.cards[0]?.offsetWidth || 160));
    }
    
    handleGridNavigation(e) {
        const gridWidth = this.getGridWidth();
        
        switch(e.key) {
            case 'ArrowRight':
                this.index = (this.index + 1) % this.cards.length;
                break;
            case 'ArrowLeft':
                this.index = (this.index - 1 + this.cards.length) % this.cards.length;
                break;
            case 'ArrowDown':
                this.index = Math.min(this.index + gridWidth, this.cards.length - 1);
                break;
            case 'Enter':
            case ' ':
                if (this.cards[this.index]) {
                    this.cards[this.index].click();
                }
                break;
            case '/':
                // Atajo r√°pido para b√∫squeda
                e.preventDefault();
                this.focusMode = 'search';
                this.searchBox.focus();
                this.searchBox.classList.add('focused');
                break;
        }
        
        if (this.focusMode === 'grid') {
            this.focusCard();
        }
    }
    
    handleSeriesNavigation(e) {
        if (!this.currentSeries || !this.currentSeries.seasons) return;
        
        const seasonKeys = Object.keys(this.currentSeries.seasons);
        
        if (this.focusMode === 'season') {
            const totalSeasons = seasonKeys.length;
            
            switch(e.key) {
                case 'ArrowRight':
                    this.seasonFocus = Math.min(this.seasonFocus + 1, totalSeasons - 1);
                    break;
                case 'ArrowLeft':
                    this.seasonFocus = Math.max(this.seasonFocus - 1, 0);
                    break;
                case 'ArrowDown':
                case 'Enter':
                case ' ':
                    this.currentSeason = this.seasonFocus;
                    this.focusMode = 'episode';
                    this.episodeFocus = 0;
                    this.renderSeasons();
                    this.renderEpisodes();
                    return;
            }
        } else if (this.focusMode === 'episode') {
            const episodes = this.currentSeries.seasons[seasonKeys[this.currentSeason]];
            if (!episodes) return;
            
            const total = episodes.length;
            
            switch(e.key) {
                case 'ArrowRight':
                    this.episodeFocus = Math.min(this.episodeFocus + 1, total - 1);
                    break;
                case 'ArrowLeft':
                    this.episodeFocus = Math.max(this.episodeFocus - 1, 0);
                    break;
                case 'ArrowUp':
                    this.focusMode = 'season';
                    this.seasonFocus = this.currentSeason;
                    break;
                case 'Enter':
                case ' ':
                    const ep = episodes[this.episodeFocus];
                    if (!ep.locked && ep.url) {
                        // Guardar en seguir viendo
                        this.saveContinueWatching(
                            this.currentSeriesId,
                            this.currentSeries.displayTitle || this.currentSeries.title,
                            this.currentSeason,
                            this.episodeFocus,
                            ep.title,
                            0,
                            ep.thumbnail
                        );
                        
                        this.playEpisode(ep.url);
                    } else if (ep.locked) {
                        this.showError('Este episodio est√° bloqueado');
                    }
                    return;
            }
        }
        
        if (e.key === 'Escape' || e.key === 'Backspace') {
            if (this.focusMode === 'episode') {
                this.focusMode = 'season';
                this.seasonFocus = this.currentSeason;
            } else {
                this.closeModal();
            }
        }
        
        this.updateSeriesFocus();
    }
    
    showLoader(show) {
        if (this.loader) {
            this.loader.classList.toggle('hidden', !show);
        }
    }
    
    showError(message) {
        this.errorMessage.textContent = message;
        this.errorMessage.classList.add('show');
        setTimeout(() => {
            this.errorMessage.classList.remove('show');
        }, 3000);
    }
    
    async refreshData() {
        // Recargar datos desde el servidor
        console.log('Actualizando datos de series...');
        await this.loadData();
    }
    
    destroy() {
        // Limpieza
        if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
        }
        document.removeEventListener('keydown', this.handleKeyboard);
    }
}

// Initialize platform when DOM is ready
let platform = null;

document.addEventListener('DOMContentLoaded', () => {
    platform = new StreamingPlatform();
    
    // Handle browser back button
    window.addEventListener('popstate', (event) => {
        if (platform.seriesOverlay.style.display === 'block') {
            platform.closeModal();
        }
    });
    
    // TV Remote Support
    if (window.navigator && window.navigator.userAgent) {
        const isTV = /TV|television|smarttv|webOS|Tizen/i.test(window.navigator.userAgent);
        if (isTV) {
            document.body.classList.add('tv-mode');
            console.log('TV Mode detected');
        }
    }
    
    // Expose platform instance for debugging
    window.streamingPlatform = platform;
});

// Handle page visibility for auto-pause
document.addEventListener('visibilitychange', () => {
    if (document.hidden && platform) {
        console.log('P√°gina oculta, pausando actividades');
    } else if (platform) {
        console.log('P√°gina visible, reanudando actividades');
    }
});
</script>

</body>
</html>




