<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movies HD</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    font-family: -apple-system, sans-serif; 
    background: #000; 
    color: #fff; 
}
header {
    padding: 20px;
    background: #111;
    position: sticky;
    top: 0;
    z-index: 10;
    display: flex;
    gap: 20px;
    align-items: center;
    border-bottom: 2px solid #e50914;
}
h1 { 
    color: #e50914; 
    font-size: 1.8rem;
}
input {
    flex: 1;
    max-width: 400px;
    padding: 10px 15px;
    border: 1px solid #333;
    border-radius: 5px;
    background: #222;
    color: #fff;
    font-size: 1rem;
}
.stats {
    display: flex;
    gap: 15px;
    align-items: center;
}
.counter {
    color: #fff;
    font-size: 0.9rem;
    background: #e50914;
    padding: 5px 15px;
    border-radius: 20px;
}
.status {
    color: #888;
    font-size: 0.9rem;
}
.filters {
    display: flex;
    gap: 10px;
    padding: 15px 20px;
    background: #0a0a0a;
    overflow-x: auto;
    border-bottom: 1px solid #222;
}
.year-btn {
    padding: 8px 20px;
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 20px;
    color: #fff;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.3s;
}
.year-btn:hover {
    background: #333;
}
.year-btn.active {
    background: #e50914;
    border-color: #e50914;
}
main {
    padding: 20px;
    min-height: 80vh;
}
.year-section {
    margin-bottom: 40px;
}
.year-title {
    font-size: 1.8rem;
    margin-bottom: 20px;
    color: #fff;
    padding-left: 10px;
    border-left: 4px solid #e50914;
}
.movies {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 20px;
}
.movie {
    cursor: pointer;
    transition: transform 0.3s;
    position: relative;
    background: #111;
    border-radius: 8px;
    overflow: hidden;
}
.movie:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 20px rgba(229, 9, 20, 0.5);
}
.movie img {
    width: 100%;
    height: 240px;
    object-fit: cover;
    display: block;
    background: #1a1a1a;
}
.movie-title {
    padding: 10px;
    font-size: 0.9rem;
    line-height: 1.3;
    min-height: 50px;
}
.loading {
    text-align: center;
    padding: 100px 20px;
}
.loader {
    width: 50px;
    height: 50px;
    border: 3px solid #333;
    border-top: 3px solid #e50914;
    border-radius: 50%;
    margin: 0 auto 20px;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    to { transform: rotate(360deg); }
}
.empty {
    text-align: center;
    padding: 100px 20px;
    color: #666;
}
.error {
    background: #330000;
    color: #ff6666;
    padding: 10px;
    margin: 20px;
    border-radius: 5px;
    display: none;
}
.error.show {
    display: block;
}
@media (max-width: 600px) {
    .movies { 
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
    }
    .movie img { height: 150px; }
    h1 { font-size: 1.3rem; }
    .movie-title { font-size: 0.8rem; padding: 8px; }
}
</style>
</head>
<body>

<header>
    <h1>MOVIES+</h1>
    <input type="text" id="search" placeholder="Buscar pel√≠culas...">
    <div class="stats">
        <span class="counter" id="counter">0</span>
        <span class="status" id="status">Cargando...</span>
    </div>
</header>

<div class="filters" id="filters">
    <button class="year-btn active" onclick="app.filterYear('all')">Todos</button>
</div>

<div class="error" id="error"></div>

<main id="main">
    <div class="loading">
        <div class="loader"></div>
        <p>Cargando pel√≠culas...</p>
        <p style="color: #666; margin-top: 10px" id="loadingInfo">0 archivos cargados</p>
    </div>
</main>

<script>
// ============================================
// CONFIGURACI√ìN - SOLO CAMBIA ESTOS VALORES
// ============================================
const CONFIG = {
    github_user: 'rancier0102-rgb',        // <-- PON TU USUARIO DE GITHUB
    github_repo: 'REPRODUCIBLE-1.0',    // <-- PON TU REPOSITORIO
    github_branch: 'main',             // <-- RAMA (normalmente 'main' o 'master')
    start_year: 2025,                  // A√±o inicial
    end_year: 1940                     // A√±o final
};

// ============================================
// APLICACI√ìN MINIMALISTA
// ============================================
const app = {
    allMovies: [],
    filteredMovies: [],
    loadedFiles: 0,
    totalFiles: 0,
    
    async init() {
        console.log('üé¨ Iniciando Movies+');
        console.log('üìÅ Repositorio:', `${CONFIG.github_user}/${CONFIG.github_repo}`);
        
        // Generar lista de a√±os
        const years = [];
        for(let y = CONFIG.start_year; y >= CONFIG.end_year; y--) {
            years.push(y);
        }
        this.totalFiles = years.length;
        
        // Cargar todos los archivos JSON
        await this.loadAllYears(years);
        
        // Finalizar
        this.finishLoading();
    },
    
    async loadAllYears(years) {
        // Dividir en lotes para cargar de a 5 archivos en paralelo
        const batchSize = 5;
        
        for(let i = 0; i < years.length; i += batchSize) {
            const batch = years.slice(i, i + batchSize);
            const promises = batch.map(year => this.loadYear(year));
            
            // Esperar que termine el lote
            await Promise.allSettled(promises);
            
            // Actualizar progreso
            document.getElementById('loadingInfo').textContent = 
                `${this.loadedFiles} de ${this.totalFiles} archivos procesados`;
        }
    },
    
    async loadYear(year) {
        const url = `https://raw.githubusercontent.com/${CONFIG.github_user}/${CONFIG.github_repo}/${CONFIG.github_branch}/peliculas_${year}.json`;
        
        try {
            console.log(`üì• Cargando: peliculas_${year}.json`);
            
            const response = await fetch(url);
            
            if (!response.ok) {
                if (response.status !== 404) {
                    console.warn(`‚ö†Ô∏è Error ${response.status} en a√±o ${year}`);
                }
                return;
            }
            
            const text = await response.text();
            const data = JSON.parse(text);
            
            // Procesar los datos (puede ser array o objeto √∫nico)
            let movies = [];
            
            if (Array.isArray(data)) {
                movies = data;
            } else if (data.peliculas && Array.isArray(data.peliculas)) {
                movies = data.peliculas;
            } else if (data.movies && Array.isArray(data.movies)) {
                movies = data.movies;
            } else if (data.titulo && data.enlace) {
                // Es un objeto √∫nico
                movies = [data];
            }
            
            // Procesar cada pel√≠cula
            let addedCount = 0;
            movies.forEach(movie => {
                if (movie && movie.titulo && movie.enlace) {
                    // Limpiar t√≠tulo y extraer a√±o si est√° en el formato "T√≠tulo (A√±o)"
                    let titulo = movie.titulo;
                    let movieYear = movie.ano || year;
                    
                    const yearMatch = titulo.match(/\((\d{4})\)$/);
                    if (yearMatch) {
                        movieYear = yearMatch[1];
                        titulo = titulo.replace(/\s*\(\d{4})\s*$/, '').trim();
                    }
                    
                    this.allMovies.push({
                        id: `${year}_${Date.now()}_${Math.random()}`,
                        titulo: titulo,
                        tituloCompleto: movie.titulo,
                        poster: movie.poster || this.getPlaceholder(titulo),
                        year: parseInt(movieYear),
                        enlace: movie.enlace,
                        categoria: movie.categoria || movie.genero || 'General'
                    });
                    addedCount++;
                }
            });
            
            console.log(`‚úÖ A√±o ${year}: ${addedCount} pel√≠culas agregadas`);
            
        } catch (error) {
            console.error(`‚ùå Error cargando a√±o ${year}:`, error.message);
        } finally {
            this.loadedFiles++;
        }
    },
    
    finishLoading() {
        console.log(`‚úÖ Carga completa: ${this.allMovies.length} pel√≠culas totales`);
        
        // Ordenar pel√≠culas por a√±o descendente y luego por t√≠tulo
        this.allMovies.sort((a, b) => {
            if (b.year !== a.year) return b.year - a.year;
            return a.titulo.localeCompare(b.titulo, 'es');
        });
        
        // Crear botones de filtro
        this.createFilterButtons();
        
        // Renderizar todas las pel√≠culas
        this.render(this.allMovies);
        
        // Configurar eventos
        this.setupEvents();
        
        // Actualizar estado
        document.getElementById('status').textContent = 'Listo';
        
        // Si no hay pel√≠culas, mostrar mensaje
        if (this.allMovies.length === 0) {
            this.showError('No se encontraron pel√≠culas. Verifica la configuraci√≥n del repositorio.');
        }
    },
    
    render(movies = this.allMovies) {
        const main = document.getElementById('main');
        
        if (movies.length === 0) {
            main.innerHTML = `
                <div class="empty">
                    <h2>No se encontraron pel√≠culas</h2>
                    <p>Intenta con otro filtro o t√©rmino de b√∫squeda</p>
                </div>`;
            document.getElementById('counter').textContent = '0';
            return;
        }
        
        // Agrupar por a√±o
        const moviesByYear = {};
        movies.forEach(movie => {
            const year = movie.year;
            if (!moviesByYear[year]) {
                moviesByYear[year] = [];
            }
            moviesByYear[year].push(movie);
        });
        
        // Ordenar a√±os descendente
        const sortedYears = Object.keys(moviesByYear).sort((a, b) => b - a);
        
        // Generar HTML
        let html = '';
        sortedYears.forEach(year => {
            html += `
                <div class="year-section">
                    <h2 class="year-title">${year} (${moviesByYear[year].length} pel√≠culas)</h2>
                    <div class="movies">`;
            
            moviesByYear[year].forEach(movie => {
                html += `
                    <div class="movie" onclick="app.play('${movie.enlace}')" title="${movie.tituloCompleto}">
                        <img src="${movie.poster}" 
                             alt="${movie.titulo}" 
                             loading="lazy"
                             onerror="this.src='${this.getPlaceholder(movie.titulo)}'">
                        <div class="movie-title">${movie.titulo}</div>
                    </div>`;
            });
            
            html += `
                    </div>
                </div>`;
        });
        
        main.innerHTML = html;
        document.getElementById('counter').textContent = movies.length.toLocaleString('es');
    },
    
    play(url) {
        console.log('‚ñ∂Ô∏è Reproduciendo:', url);
        window.open(url, '_blank');
    },
    
    setupEvents() {
        // B√∫squeda con debounce
        let searchTimeout;
        document.getElementById('search').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const query = e.target.value.toLowerCase().trim();
                
                if (!query) {
                    this.render(this.allMovies);
                } else {
                    const filtered = this.allMovies.filter(movie => 
                        movie.titulo.toLowerCase().includes(query) ||
                        movie.tituloCompleto.toLowerCase().includes(query) ||
                        movie.year.toString().includes(query) ||
                        movie.categoria.toLowerCase().includes(query)
                    );
                    this.render(filtered);
                }
            }, 300);
        });
    },
    
    createFilterButtons() {
        // Obtener a√±os √∫nicos con pel√≠culas
        const years = [...new Set(this.allMovies.map(m => m.year))].sort((a, b) => b - a);
        
        // Agregar botones de los primeros 10 a√±os con contenido
        const container = document.getElementById('filters');
        
        years.slice(0, 10).forEach(year => {
            const count = this.allMovies.filter(m => m.year === year).length;
            const btn = document.createElement('button');
            btn.className = 'year-btn';
            btn.textContent = `${year} (${count})`;
            btn.onclick = () => this.filterYear(year);
            container.appendChild(btn);
        });
        
        // Agregar bot√≥n de d√©cadas si hay pel√≠culas antiguas
        if (years.some(y => y < 2000)) {
            const btn90s = document.createElement('button');
            btn90s.className = 'year-btn';
            btn90s.textContent = '90s';
            btn90s.onclick = () => this.filterDecade(1990, 1999);
            container.appendChild(btn90s);
            
            const btn80s = document.createElement('button');
            btn80s.className = 'year-btn';
            btn80s.textContent = '80s';
            btn80s.onclick = () => this.filterDecade(1980, 1989);
            container.appendChild(btn80s);
            
            const btnClassic = document.createElement('button');
            btnClassic.className = 'year-btn';
            btnClassic.textContent = 'Cl√°sicas';
            btnClassic.onclick = () => this.filterDecade(1940, 1979);
            container.appendChild(btnClassic);
        }
    },
    
    filterYear(year) {
        // Actualizar botones activos
        document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        if (year === 'all') {
            this.render(this.allMovies);
        } else {
            const filtered = this.allMovies.filter(m => m.year === year);
            this.render(filtered);
        }
    },
    
    filterDecade(startYear, endYear) {
        // Actualizar botones activos
        document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        const filtered = this.allMovies.filter(m => m.year >= startYear && m.year <= endYear);
        this.render(filtered);
    },
    
    getPlaceholder(title = 'Movie') {
        // Placeholder con el t√≠tulo de la pel√≠cula
        const text = encodeURIComponent(title.substring(0, 20));
        return `https://via.placeholder.com/300x450/1a1a1a/e50914?text=${text}`;
    },
    
    showError(message) {
        const errorDiv = document.getElementById('error');
        errorDiv.textContent = `‚ö†Ô∏è ${message}`;
        errorDiv.classList.add('show');
        
        setTimeout(() => {
            errorDiv.classList.remove('show');
        }, 5000);
    }
};

// ============================================
// INICIAR APLICACI√ìN
// ============================================
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM Cargado - Iniciando aplicaci√≥n...');
    app.init();
});

// Debug helper
window.app = app;
</script>

</body>
</html>
