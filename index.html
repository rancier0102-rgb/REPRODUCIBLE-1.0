<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fire TV Movies</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

/* HEADER */
.header {
    position: fixed;
    top: 0;
    width: 100%;
    padding: 20px 40px;
    background: linear-gradient(180deg, #000 0%, transparent 100%);
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-size: 28px;
    font-weight: bold;
    color: #e50914;
}

.status {
    font-size: 14px;
    color: #999;
}

/* CONTENEDOR PRINCIPAL */
.container {
    padding: 100px 40px 40px;
    height: 100vh;
    overflow-y: auto;
    scroll-behavior: smooth;
}

/* SECCIONES */
.section {
    margin-bottom: 40px;
}

.section-title {
    font-size: 22px;
    margin-bottom: 20px;
    color: #fff;
}

/* GRID DE PEL칈CULAS */
.movies-row {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding: 10px 0;
    scrollbar-width: none;
}

.movies-row::-webkit-scrollbar {
    display: none;
}

/* TARJETAS */
.movie-card {
    flex: 0 0 200px;
    cursor: pointer;
    transition: transform 0.2s;
    position: relative;
    background: #1a1a1a;
    border-radius: 4px;
    overflow: hidden;
}

.movie-card:focus {
    outline: 3px solid #e50914;
    outline-offset: 2px;
    transform: scale(1.1);
    z-index: 10;
}

.movie-card:focus .movie-info {
    opacity: 1;
}

.movie-poster {
    width: 100%;
    aspect-ratio: 2/3;
    background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
    position: relative;
}

.movie-poster img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.quality {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #e50914;
    padding: 4px 8px;
    border-radius: 3px;
    font-size: 12px;
    font-weight: bold;
}

/* INFO */
.movie-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 15px;
    background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
    opacity: 0;
    transition: opacity 0.2s;
}

.movie-title {
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 5px;
}

.movie-meta {
    font-size: 12px;
    color: #999;
}

/* LOADER */
.loader {
    position: fixed;
    inset: 0;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.loader.hide {
    display: none;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 3px solid #333;
    border-top-color: #e50914;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* MENSAJE */
.message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(229, 9, 20, 0.95);
    padding: 20px 40px;
    border-radius: 8px;
    font-size: 18px;
    z-index: 2000;
    display: none;
}

.message.show {
    display: block;
}

/* EMPTY */
.empty {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    display: none;
}

.empty.show {
    display: block;
}

/* TV MODE */
@media screen and (min-width: 1920px) {
    .movie-card { flex: 0 0 240px; }
    .header { padding: 25px 50px; }
    .container { padding: 120px 50px 50px; }
}
</style>
</head>
<body>

<!-- Loader -->
<div class="loader" id="loader">
    <div class="spinner"></div>
</div>

<!-- Header -->
<header class="header">
    <div class="logo">MOVIES+</div>
    <div class="status" id="status">Cargando...</div>
</header>

<!-- Container -->
<div class="container" id="container"></div>

<!-- Empty State -->
<div class="empty" id="empty">
    <h2>No hay pel칤culas</h2>
    <p>Verifica la configuraci칩n</p>
</div>

<!-- Message -->
<div class="message" id="message"></div>

<script>
// ========================================
// CONFIGURACI칍N
// ========================================
const CONFIG = {
    GITHUB_USER: 'rancier0102-rgb',
    GITHUB_REPO: 'REPRODUCIBLE-1.0',
    GITHUB_BRANCH: 'main',
    
    get BASE_URL() {
        return `https://raw.githubusercontent.com/${this.GITHUB_USER}/${this.GITHUB_REPO}/${this.GITHUB_BRANCH}`;
    },
    
    get MANIFEST_URL() {
        return `${this.BASE_URL}/manifest.json`;
    }
};

// ========================================
// APP PRINCIPAL
// ========================================
class FireTVApp {
    constructor() {
        this.movies = [];
        this.organized = {};
        this.currentFocus = { row: 0, col: 0 };
        this.rows = [];
        
        this.init();
    }
    
    async init() {
        try {
            await this.loadMovies();
            this.organize();
            this.render();
            this.setupNavigation();
            this.hideLoader();
        } catch (error) {
            console.error('Error:', error);
            this.showEmpty();
        }
    }
    
    async loadMovies() {
        try {
            // Intentar cargar desde GitHub
            const response = await fetch(CONFIG.MANIFEST_URL);
            
            if (!response.ok) {
                throw new Error('No se pudo cargar manifest');
            }
            
            const manifest = await response.json();
            
            // Cargar chunks
            for (const chunk of manifest.chunks || []) {
                try {
                    const chunkUrl = `${CONFIG.BASE_URL}/${chunk.file}`;
                    const chunkResponse = await fetch(chunkUrl);
                    
                    if (chunkResponse.ok) {
                        const data = await chunkResponse.json();
                        this.processData(data);
                    }
                } catch (e) {
                    console.error('Error chunk:', e);
                }
            }
            
            this.updateStatus(`${this.movies.length} pel칤culas`);
            
        } catch (error) {
            // Cargar demo si falla
            this.loadDemo();
        }
    }
    
    processData(data) {
        const items = data.movies || data.series || [];
        
        items.forEach(item => {
            this.movies.push({
                id: item.id || Date.now(),
                title: item.t || item.title || 'Sin t칤tulo',
                url: item.l || item.url || '#',
                year: item.y || item.year || 2024,
                poster: item.p || item.poster || this.defaultPoster(),
                quality: item.q || item.calidad || 'HD'
            });
        });
    }
    
    loadDemo() {
        // Generar pel칤culas demo
        for (let year = 2024; year >= 2020; year--) {
            for (let i = 1; i <= 10; i++) {
                this.movies.push({
                    id: `${year}_${i}`,
                    title: `Pel칤cula ${i}`,
                    url: '#demo',
                    year: year,
                    poster: this.defaultPoster(),
                    quality: 'HD'
                });
            }
        }
        
        this.updateStatus('Modo Demo');
    }
    
    organize() {
        // Organizar por a침o
        this.movies.forEach(movie => {
            const year = movie.year;
            if (!this.organized[year]) {
                this.organized[year] = [];
            }
            this.organized[year].push(movie);
        });
    }
    
    render() {
        const container = document.getElementById('container');
        
        if (this.movies.length === 0) {
            this.showEmpty();
            return;
        }
        
        container.innerHTML = '';
        this.rows = [];
        
        // Ordenar a침os
        const years = Object.keys(this.organized).sort((a, b) => b - a);
        
        years.forEach(year => {
            const section = document.createElement('div');
            section.className = 'section';
            
            const title = document.createElement('h2');
            title.className = 'section-title';
            title.textContent = `Pel칤culas ${year}`;
            
            const row = document.createElement('div');
            row.className = 'movies-row';
            row.dataset.row = this.rows.length;
            
            this.organized[year].forEach((movie, index) => {
                const card = this.createCard(movie, this.rows.length, index);
                row.appendChild(card);
            });
            
            section.appendChild(title);
            section.appendChild(row);
            container.appendChild(section);
            
            this.rows.push(row);
        });
        
        // Focus inicial
        if (this.rows.length > 0) {
            const firstCard = this.rows[0].querySelector('.movie-card');
            if (firstCard) firstCard.focus();
        }
    }
    
    createCard(movie, row, col) {
        const card = document.createElement('div');
        card.className = 'movie-card';
        card.tabIndex = 0;
        card.dataset.row = row;
        card.dataset.col = col;
        card.dataset.url = movie.url;
        
        card.innerHTML = `
            <div class="movie-poster">
                <img src="${movie.poster}" alt="${movie.title}" 
                     onerror="this.src='${this.defaultPoster()}'">
                <span class="quality">${movie.quality}</span>
            </div>
            <div class="movie-info">
                <div class="movie-title">${movie.title}</div>
                <div class="movie-meta">${movie.year}</div>
            </div>
        `;
        
        return card;
    }
    
    setupNavigation() {
        document.addEventListener('keydown', (e) => {
            this.handleKeyPress(e);
        });
        
        // Click para reproducir
        document.addEventListener('click', (e) => {
            const card = e.target.closest('.movie-card');
            if (card) {
                this.play(card.dataset.url);
            }
        });
    }
    
    handleKeyPress(e) {
        const key = e.key;
        
        switch(key) {
            case 'ArrowRight':
                e.preventDefault();
                this.navigate(0, 1);
                break;
                
            case 'ArrowLeft':
                e.preventDefault();
                this.navigate(0, -1);
                break;
                
            case 'ArrowDown':
                e.preventDefault();
                this.navigate(1, 0);
                break;
                
            case 'ArrowUp':
                e.preventDefault();
                this.navigate(-1, 0);
                break;
                
            case 'Enter':
                e.preventDefault();
                const focused = document.activeElement;
                if (focused && focused.classList.contains('movie-card')) {
                    this.play(focused.dataset.url);
                }
                break;
                
            case 'Escape':
            case 'Backspace':
                e.preventDefault();
                if (confirm('쯉alir?')) {
                    window.history.back();
                }
                break;
        }
    }
    
    navigate(rowDelta, colDelta) {
        if (this.rows.length === 0) return;
        
        // Calcular nueva posici칩n
        let newRow = this.currentFocus.row + rowDelta;
        let newCol = this.currentFocus.col + colDelta;
        
        // Validar l칤mites de filas
        if (newRow < 0) newRow = 0;
        if (newRow >= this.rows.length) newRow = this.rows.length - 1;
        
        const row = this.rows[newRow];
        const cards = row.querySelectorAll('.movie-card');
        
        // Validar l칤mites de columnas
        if (newCol < 0) newCol = 0;
        if (newCol >= cards.length) newCol = cards.length - 1;
        
        // Actualizar focus
        this.currentFocus.row = newRow;
        this.currentFocus.col = newCol;
        
        // Aplicar focus
        const target = cards[newCol];
        if (target) {
            target.focus();
            
            // Scroll horizontal
            const rowElement = row;
            const cardRect = target.getBoundingClientRect();
            const rowRect = rowElement.getBoundingClientRect();
            
            if (cardRect.left < rowRect.left) {
                rowElement.scrollLeft -= rowRect.left - cardRect.left + 20;
            } else if (cardRect.right > rowRect.right) {
                rowElement.scrollLeft += cardRect.right - rowRect.right + 20;
            }
            
            // Scroll vertical
            target.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
        }
    }
    
    play(url) {
        if (!url || url === '#' || url === '#demo') {
            this.showMessage('Pel칤cula de demostraci칩n');
            return;
        }
        
        // Abrir reproductor
        window.open(url, '_blank');
    }
    
    showMessage(text) {
        const msg = document.getElementById('message');
        msg.textContent = text;
        msg.classList.add('show');
        
        setTimeout(() => {
            msg.classList.remove('show');
        }, 2000);
    }
    
    updateStatus(text) {
        document.getElementById('status').textContent = text;
    }
    
    hideLoader() {
        document.getElementById('loader').classList.add('hide');
    }
    
    showEmpty() {
        document.getElementById('empty').classList.add('show');
        document.getElementById('container').style.display = 'none';
        this.hideLoader();
    }
    
    defaultPoster() {
        return 'data:image/svg+xml,' + encodeURIComponent(`
            <svg xmlns="http://www.w3.org/2000/svg" width="200" height="300">
                <rect width="200" height="300" fill="#1a1a1a"/>
                <text x="100" y="150" font-size="48" fill="#333" text-anchor="middle">游꿟</text>
            </svg>
        `);
    }
}

// INICIAR
window.addEventListener('DOMContentLoaded', () => {
    new FireTVApp();
});
</script>

</body>
</html>
