{
  "$schema": "./cdn-config.schema.json",
  "version": "1.0.0",
  "lastUpdate": "2024-01-15T10:00:00Z",
  
  "providers": {
    "primary": {
      "name": "cloudflare",
      "enabled": true,
      "type": "pull",
      "endpoints": {
        "global": "https://cdn.tvcinema.com",
        "americas": "https://us.cdn.tvcinema.com",
        "europe": "https://eu.cdn.tvcinema.com",
        "asia": "https://asia.cdn.tvcinema.com",
        "oceania": "https://au.cdn.tvcinema.com"
      },
      "features": {
        "http2": true,
        "http3": true,
        "brotli": true,
        "webp": true,
        "avif": true,
        "imageOptimization": true,
        "videoOptimization": true,
        "adaptiveServing": true,
        "edgeWorkers": true,
        "waf": true,
        "ddosProtection": true
      },
      "cache": {
        "html": {
          "ttl": 300,
          "browserTTL": 0,
          "cacheControl": "no-cache, no-store, must-revalidate",
          "edgeCache": false
        },
        "css": {
          "ttl": 31536000,
          "browserTTL": 31536000,
          "cacheControl": "public, max-age=31536000, immutable",
          "edgeCache": true
        },
        "js": {
          "ttl": 31536000,
          "browserTTL": 31536000,
          "cacheControl": "public, max-age=31536000, immutable",
          "edgeCache": true
        },
        "images": {
          "ttl": 31536000,
          "browserTTL": 604800,
          "cacheControl": "public, max-age=604800",
          "edgeCache": true
        },
        "videos": {
          "ttl": 604800,
          "browserTTL": 3600,
          "cacheControl": "public, max-age=3600",
          "edgeCache": true
        },
        "api": {
          "ttl": 0,
          "browserTTL": 0,
          "cacheControl": "no-cache",
          "edgeCache": false
        },
        "manifest": {
          "ttl": 300,
          "browserTTL": 300,
          "cacheControl": "public, max-age=300",
          "edgeCache": true
        }
      },
      "optimization": {
        "minify": {
          "html": true,
          "css": true,
          "js": true,
          "svg": true
        },
        "compression": {
          "gzip": true,
          "brotli": true,
          "level": 6
        },
        "images": {
          "quality": 85,
          "format": "auto",
          "lazy": true,
          "responsive": true,
          "sizes": [320, 640, 960, 1280, 1920, 3840],
          "formats": ["webp", "avif", "jpg"],
          "polish": "lossy"
        },
        "video": {
          "codec": "auto",
          "bitrate": "adaptive",
          "resolution": "auto",
          "streaming": "hls"
        }
      },
      "security": {
        "ssl": "full-strict",
        "tls": "1.3",
        "hsts": {
          "enabled": true,
          "maxAge": 31536000,
          "includeSubdomains": true,
          "preload": true
        },
        "headers": {
          "X-Content-Type-Options": "nosniff",
          "X-Frame-Options": "DENY",
          "X-XSS-Protection": "1; mode=block",
          "Referrer-Policy": "strict-origin-when-cross-origin",
          "Permissions-Policy": "geolocation=(), microphone=(), camera=()"
        },
        "waf": {
          "enabled": true,
          "rules": "managed",
          "level": "medium"
        },
        "botManagement": {
          "enabled": true,
          "challengeThreshold": 30
        },
        "rateLimit": {
          "enabled": true,
          "requests": 100,
          "period": 60,
          "action": "challenge"
        }
      },
      "performance": {
        "http2Push": true,
        "earlyHints": true,
        "prefetch": [
          "/css/tv-layout.css",
          "/js/app.js",
          "/fonts/main.woff2"
        ],
        "preconnect": [
          "https://api.tvcinema.com",
          "https://stream.tvcinema.com"
        ],
        "dnsPrefetch": [
          "cdn.tvcinema.com",
          "api.tvcinema.com",
          "stream.tvcinema.com"
        ],
        "criticalCSS": true,
        "lazyLoad": {
          "images": true,
          "iframes": true,
          "scripts": true
        },
        "resourceHints": true
      },
      "analytics": {
        "enabled": true,
        "realtime": true,
        "metrics": [
          "bandwidth",
          "requests",
          "cacheHitRatio",
          "responseTime",
          "errors"
        ]
      },
      "failover": {
        "enabled": true,
        "healthCheck": {
          "interval": 60,
          "timeout": 5,
          "retries": 2
        },
        "backup": "secondary"
      }
    },
    
    "secondary": {
      "name": "fastly",
      "enabled": true,
      "type": "pull",
      "endpoints": {
        "global": "https://cdn2.tvcinema.com",
        "americas": "https://us.cdn2.tvcinema.com",
        "europe": "https://eu.cdn2.tvcinema.com",
        "asia": "https://asia.cdn2.tvcinema.com"
      },
      "features": {
        "http2": true,
        "http3": false,
        "brotli": true,
        "webp": true,
        "imageOptimization": true,
        "edgeCompute": true,
        "instantPurge": true
      },
      "cache": {
        "defaultTTL": 3600,
        "maxTTL": 31536000,
        "staleWhileRevalidate": 86400,
        "staleIfError": 604800
      }
    },
    
    "storage": {
      "name": "s3",
      "enabled": true,
      "type": "origin",
      "endpoints": {
        "primary": "https://s3.amazonaws.com/tvcinema",
        "backup": "https://s3-eu.amazonaws.com/tvcinema"
      },
      "bucket": "tvcinema-media",
      "region": "us-east-1",
      "features": {
        "versioning": true,
        "encryption": true,
        "lifecycle": true,
        "replication": true,
        "transferAcceleration": true
      },
      "structure": {
        "images": {
          "path": "/images",
          "public": true,
          "cors": true
        },
        "videos": {
          "path": "/videos",
          "public": false,
          "signedUrls": true,
          "expiry": 3600
        },
        "data": {
          "path": "/data",
          "public": true,
          "cors": true
        },
        "static": {
          "path": "/static",
          "public": true,
          "cors": false
        }
      }
    },
    
    "streaming": {
      "name": "cloudfront",
      "enabled": true,
      "type": "streaming",
      "endpoints": {
        "hls": "https://stream.tvcinema.com/hls",
        "dash": "https://stream.tvcinema.com/dash",
        "smooth": "https://stream.tvcinema.com/smooth"
      },
      "features": {
        "adaptiveBitrate": true,
        "multiCodec": true,
        "drm": true,
        "liveStreaming": false,
        "dvr": false,
        "thumbnails": true,
        "captions": true
      },
      "quality": {
        "profiles": [
          {
            "name": "4K",
            "width": 3840,
            "height": 2160,
            "bitrate": 25000,
            "codec": "h265"
          },
          {
            "name": "1080p",
            "width": 1920,
            "height": 1080,
            "bitrate": 8000,
            "codec": "h264"
          },
          {
            "name": "720p",
            "width": 1280,
            "height": 720,
            "bitrate": 5000,
            "codec": "h264"
          },
          {
            "name": "480p",
            "width": 854,
            "height": 480,
            "bitrate": 2500,
            "codec": "h264"
          }
        ],
        "audio": {
          "codec": "aac",
          "bitrate": 128,
          "channels": 2
        }
      },
      "packaging": {
        "segmentDuration": 6,
        "playlistLength": 10,
        "keyRotation": false
      },
      "delivery": {
        "protocol": "https",
        "tokenAuth": true,
        "geoRestriction": false,
        "refererCheck": true
      }
    }
  },
  
  "routing": {
    "strategy": "performance",
    "rules": [
      {
        "pattern": "*.html",
        "provider": "primary",
        "cache": false
      },
      {
        "pattern": "*.css|*.js",
        "provider": "primary",
        "cache": true,
        "immutable": true
      },
      {
        "pattern": "*.jpg|*.png|*.webp|*.avif",
        "provider": "primary",
        "cache": true,
        "optimize": true
      },
      {
        "pattern": "*.mp4|*.webm",
        "provider": "streaming",
        "cache": true,
        "stream": true
      },
      {
        "pattern": "/api/*",
        "provider": "origin",
        "cache": false,
        "cors": true
      },
      {
        "pattern": "/data/*",
        "provider": "storage",
        "cache": true,
        "compress": true
      }
    ],
    "geoRouting": {
      "enabled": true,
      "rules": [
        {
          "region": "NA",
          "endpoint": "americas"
        },
        {
          "region": "EU",
          "endpoint": "europe"
        },
        {
          "region": "AS",
          "endpoint": "asia"
        },
        {
          "region": "OC",
          "endpoint": "oceania"
        }
      ]
    },
    "loadBalancing": {
      "algorithm": "round-robin",
      "healthCheck": true,
      "stickySession": false
    }
  },
  
  "purge": {
    "enabled": true,
    "strategies": {
      "instant": {
        "enabled": true,
        "paths": ["/api/*", "/data/movies/collections/*"]
      },
      "scheduled": {
        "enabled": true,
        "cron": "0 */6 * * *",
        "paths": ["/data/movies/metadata/*"]
      },
      "smart": {
        "enabled": true,
        "maxAge": 604800,
        "unused": 86400
      }
    },
    "api": {
      "endpoint": "https://api.cdn.tvcinema.com/purge",
      "auth": "bearer",
      "rateLimit": 100
    }
  },
  
  "monitoring": {
    "enabled": true,
    "realtime": true,
    "alerts": {
      "enabled": true,
      "channels": ["email", "slack"],
      "thresholds": {
        "errorRate": 0.01,
        "latency": 1000,
        "availability": 99.9,
        "bandwidth": 1000000000,
        "cacheHitRatio": 0.8
      }
    },
    "metrics": {
      "collect": [
        "requests",
        "bandwidth",
        "latency",
        "errors",
        "cacheHits",
        "uniqueVisitors",
        "pageViews"
      ],
      "retention": 90,
      "aggregation": "1m",
      "export": {
        "enabled": true,
        "format": "json",
        "destination": "s3://tvcinema-metrics"
      }
    },
    "logging": {
      "enabled": true,
      "level": "info",
      "format": "json",
      "fields": [
        "timestamp",
        "method",
        "path",
        "status",
        "latency",
        "size",
        "referer",
        "userAgent",
        "country",
        "cacheStatus"
      ],
      "destination": "s3://tvcinema-logs",
      "retention": 30
    }
  },
  
  "optimization": {
    "autoOptimize": true,
    "rules": [
      {
        "name": "WebP conversion",
        "condition": "accept:image/webp",
        "action": "convert",
        "target": "webp"
      },
      {
        "name": "AVIF conversion",
        "condition": "accept:image/avif",
        "action": "convert",
        "target": "avif"
      },
      {
        "name": "Mobile optimization",
        "condition": "device:mobile",
        "action": "resize",
        "maxWidth": 1280
      },
      {
        "name": "TV optimization",
        "condition": "device:tv",
        "action": "quality",
        "value": 90
      }
    ],
    "preload": {
      "enabled": true,
      "resources": [
        {
          "type": "font",
          "url": "/fonts/main.woff2",
          "crossorigin": "anonymous"
        },
        {
          "type": "style",
          "url": "/css/tv-layout.css"
        },
        {
          "type": "script",
          "url": "/js/app.js",
          "module": true
        }
      ]
    },
    "criticalPath": {
      "css": true,
      "fonts": true,
      "images": ["logo", "hero"]
    }
  },
  
  "costs": {
    "budget": {
      "monthly": 5000,
      "alerts": [1000, 2500, 4000, 4500],
      "currency": "USD"
    },
    "optimization": {
      "enabled": true,
      "rules": [
        {
          "name": "Reduce quality on high traffic",
          "trigger": "bandwidth > 1TB",
          "action": "reduce_quality",
          "value": 10
        },
        {
          "name": "Enable aggressive caching",
          "trigger": "requests > 1000000",
          "action": "increase_ttl",
          "value": 2
        }
      ]
    },
    "providers": {
      "cloudflare": {
        "plan": "enterprise",
        "bandwidth": "unlimited",
        "requests": "unlimited",
        "cost": 2000
      },
      "s3": {
        "storage": "1TB",
        "transfer": "10TB",
        "requests": "10M",
        "cost": 1500
      },
      "cloudfront": {
        "transfer": "10TB",
        "requests": "100M",
        "cost": 1500
      }
    }
  }
}
